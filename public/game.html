<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ĞŸÑ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ĞºÑƒÑ€ÑŒĞµÑ€Ğ°</title>

<!-- ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² -->
<link rel="preload" href="https://cdn.poehali.dev/files/d91aa39a-b906-481f-95ef-6c750cb6a76a.png" as="image" />
<link rel="preload" href="https://cdn.poehali.dev/files/6f16d2d4-f371-4b0f-a43e-c70a6de7b033.jpg" as="image" />

<style>
  /* --- Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ --- */
  *, *::before, *::after {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  html, body {
    height: 100%;
    width: 100%;
    overflow: hidden;
    font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
    background: #000;
    color: #FFD700;
    user-select: none;
  }
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* --- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¸Ğ³Ñ€Ñ‹ --- */
  #container {
    flex: 1 1 auto;
    width: 100vw;
    max-width: 100vw;
    max-height: 100vh;
    display: flex;
    flex-direction: column;
    background: transparent;
  }

  /* ğŸ†• ĞŸĞ°Ñ€Ğ°Ğ»Ğ»Ğ°ĞºÑ Ñ„Ğ¾Ğ½ Ñ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ¼ */
  .parallax-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 200%;
    height: 100%;
    background: linear-gradient(to bottom, #1a1a2e 0%, #0f3460 50%, #16213e 100%);
    z-index: 0;
  }
  
  /* ğŸ†• Ğ—Ğ²ĞµĞ·Ğ´Ñ‹ Ğ½Ğ° Ñ„Ğ¾Ğ½Ğµ */
  .stars {
    position: absolute;
    width: 200%;
    height: 100%;
    background-image: 
      radial-gradient(2px 2px at 20% 30%, white, transparent),
      radial-gradient(2px 2px at 60% 70%, white, transparent),
      radial-gradient(1px 1px at 50% 50%, white, transparent),
      radial-gradient(1px 1px at 80% 10%, white, transparent),
      radial-gradient(2px 2px at 90% 60%, white, transparent);
    background-size: 200px 200px;
    animation: starsMove 60s linear infinite;
    opacity: 0.6;
  }
  @keyframes starsMove {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* --- Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ¸ Ğ½Ğ¸Ğ¶Ğ½ÑÑ Ğ¿Ğ¾Ğ»Ğ¾ÑÑ‹ Ñ Ğ»ĞµÑĞ¾Ğ¼ --- */
  .city-strip {
    flex-shrink: 0;
    height: clamp(3rem, 8vw, 5rem);
    background: linear-gradient(to bottom, #2e7d32, #145214);
    overflow: hidden;
    position: relative;
    font-size: clamp(2rem, 6vw, 3rem);
    line-height: clamp(3rem, 8vw, 5rem);
    white-space: nowrap;
    color: #a5d6a7;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }
  .scrolling-objects {
    position: absolute;
    top: 0; left: 0;
    height: 100%;
    width: 200%;
    whitespace: nowrap;
    animation: scrollLeft 20s linear infinite;
    font-size: clamp(2rem, 6vw, 3rem);
  }
  @keyframes scrollLeft {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* ğŸ†• Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğµ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ */
  #game {
    flex: 1 1 auto;
    position: relative;
    width: 100%;
    max-width: 100vw;
    height: 100%;
    max-height: calc(100vh - 2 * clamp(3rem, 8vw, 5rem));
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    padding: 0 1vw;
    background: 
      linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.05) 50%, transparent 100%),
      linear-gradient(#3a3a4a 10%, #2d2d3d 50%, #3a3a4a 90%);
    box-shadow: 
      inset 0 0 50px rgba(0,0,0,0.8),
      inset 0 0 100px rgba(106,13,173,0.3);
  }
  
  /* ğŸ†• ĞŸĞ¾Ğ»Ğ¾ÑÑ‹ Ñ Ñ‚ĞµĞ½ÑĞ¼Ğ¸ Ğ¸ Ğ±Ğ»Ğ¸ĞºĞ°Ğ¼Ğ¸ */
  .lane {
    flex: 1;
    position: relative;
    border: none;
    background: transparent;
    overflow: visible;
  }
  .lane::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 6px;
    background:
      repeating-linear-gradient(
        to right,
        rgba(255,255,255,0.9) 0,
        rgba(255,255,255,0.9) 20px,
        transparent 20px,
        transparent 40px
      );
    opacity: 0.8;
    transform: translateY(-50%);
    animation: dashMove linear infinite;
    pointer-events: none;
    z-index: 2;
    animation-duration: 0.8s;
    filter: drop-shadow(0 0 3px rgba(255,255,255,0.5));
  }
  @keyframes dashMove {
    0% { background-position: 0 0; }
    100% { background-position: -40px 0; }
  }

  /* ğŸ†• Ğ­Ñ„Ñ„ĞµĞºÑ‚ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ - Ğ»Ğ¸Ğ½Ğ¸Ğ¸ Ğ²ĞµÑ‚Ñ€Ğ° */
  .speed-lines {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .speed-line {
    position: absolute;
    height: 2px;
    background: linear-gradient(to left, transparent, rgba(255,255,255,0.6), transparent);
    animation: speedLineMove 0.6s linear infinite;
  }
  @keyframes speedLineMove {
    0% { left: 100%; width: 20%; }
    100% { left: -20%; width: 20%; }
  }

  /* ğŸ†• ĞšÑƒÑ€ÑŒĞµÑ€ Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğ¹ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ */
  #courier {
    position: absolute;
    left: 10%;
    font-size: clamp(3rem, 8vw, 4rem);
    user-select: none;
    pointer-events: none;
    z-index: 10;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5)) drop-shadow(0 0 20px rgba(255,215,0,0.3));
    transform-origin: center bottom;
    width: 1em;
    height: 1em;
    transform: scaleX(-1);
    transition: top 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: top;
  }
  
  @media (min-width: 768px) {
    #courier {
      animation: sway 2s ease-in-out infinite;
    }
  }
  @keyframes sway {
    0%, 100% { transform: scaleX(-1) translateX(0) rotate(0deg); }
    25% { transform: scaleX(-1) translateX(-0.1em) rotate(-3deg); }
    50% { transform: scaleX(-1) translateX(0) rotate(0deg); }
    75% { transform: scaleX(-1) translateX(0.1em) rotate(3deg); }
  }

  /* ğŸ†• Ğ¤Ğ°Ñ€Ğ° ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚Ğ° */
  #courier::before {
    content: "";
    position: absolute;
    left: -0.5em;
    top: 50%;
    width: 2em;
    height: 0.3em;
    background: radial-gradient(ellipse at center, rgba(255,255,100,0.6), transparent 70%);
    transform: translateY(-50%);
    pointer-events: none;
    z-index: -1;
    animation: headlightPulse 2s ease-in-out infinite;
  }
  @keyframes headlightPulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 0.9; }
  }

  #dog {
    position: absolute;
    top: 0;
    left: 0.6em;
    font-size: 0.625em;
    opacity: 0.7;
    user-select: none;
    pointer-events: none;
    z-index: 0;
    animation: rideDog 1s ease-in-out infinite;
    transform-origin: center center;
  }
  #helmet {
    position: absolute;
    top: 0.1em;
    left: 0.6em;
    width: 0.2em;
    height: 0.15em;
    background: gold;
    border-radius: 1rem 1rem 0 0;
    box-shadow: 
      inset 0 -0.3rem 0.2rem #cc9f00,
      0 0 10px rgba(255,215,0,0.6);
    z-index: 0;
    animation: rideDog 1s ease-in-out infinite;
  }
  #scooter {
    position: relative;
    z-index: 1;
    user-select: none;
    pointer-events: none;
    animation: rideScooter 1s ease-in-out infinite;
    transform-origin: center bottom;
  }
  @keyframes rideScooter {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-0.3rem) rotate(-3deg); }
    50% { transform: translateY(0) rotate(0deg); }
    75% { transform: translateY(-0.3rem) rotate(3deg); }
  }
  @keyframes rideDog {
    0%, 100% { transform: translateY(0); }
    25% { transform: translateY(-0.2rem); }
    50% { transform: translateY(0); }
    75% { transform: translateY(-0.2rem); }
  }

  /* ğŸ†• Ğ§Ğ°ÑÑ‚Ğ¸Ñ†Ñ‹ Ğ¿Ñ‹Ğ»Ğ¸ */
  .dust-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(150,150,150,0.6);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
    animation: dustFloat 0.6s ease-out forwards;
  }
  @keyframes dustFloat {
    0% {
      opacity: 1;
      transform: translate(0, 0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(-30px, 10px) scale(0.3);
    }
  }

  /* --- ĞĞ±Ğ»Ğ°ĞºĞ¾ Ñ€ĞµÑ‡Ğ¸ ĞºÑƒÑ€ÑŒĞµÑ€Ğ° --- */
  #speechBubble {
    position: absolute;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 1rem;
    font-size: clamp(0.8rem, 2vw, 1rem);
    max-width: 90vw;
    width: auto;
    pointer-events: none;
    user-select: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.4),
      0 0 20px rgba(102,126,234,0.4);
    z-index: 20;
    font-weight: 700;
    white-space: nowrap;
    border: 3px solid #000;
  }
  #speechBubble::after {
    content: "";
    position: absolute;
    bottom: -0.5rem;
    left: 50%;
    transform: translateX(-50%);
    border-width: 0.5rem 0.5rem 0 0.5rem;
    border-style: solid;
    border-color: #667eea transparent transparent transparent;
    filter: drop-shadow(0 2px 0 #000);
  }

  /* ğŸ†• Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ */
  .pedestrian, .food, .medkit, .bonus, .policeCar, .policeStanding {
    position: absolute;
    font-size: clamp(2rem, 6vw, 3rem);
    user-select: none;
    pointer-events: none;
    z-index: 5;
    will-change: left;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
    animation: objectFloat 2s ease-in-out infinite;
  }
  
  @keyframes objectFloat {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-5px) scale(1.05); }
  }
  
  /* ğŸ†• ĞŸÑƒĞ»ÑŒÑĞ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ĞµĞ´Ñ‹ */
  .food {
    animation: foodPulse 1.5s ease-in-out infinite, objectFloat 2s ease-in-out infinite;
    filter: drop-shadow(0 0 10px #ffd54f) drop-shadow(0 4px 6px rgba(0,0,0,0.4));
  }
  @keyframes foodPulse {
    0%, 100% { filter: drop-shadow(0 0 10px #ffd54f) brightness(1); }
    50% { filter: drop-shadow(0 0 20px #ffd54f) brightness(1.2); }
  }

  /* ğŸ†• ĞœĞµĞ´ĞºĞ¸Ñ‚ Ñ ĞºÑ€ĞµÑÑ‚Ğ¾Ğ¼ */
  .medkit {
    animation: medkitPulse 1s ease-in-out infinite;
    filter: drop-shadow(0 0 15px #e57373) drop-shadow(0 4px 6px rgba(0,0,0,0.4));
  }
  @keyframes medkitPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

  /* ğŸ†• ĞŸĞ¾Ğ»Ğ¸Ñ†ĞµĞ¹ÑĞºĞ°Ñ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ° Ñ Ğ¼Ğ¸Ğ³Ğ°Ğ»ĞºĞ¾Ğ¹ */
  .policeCar {
    filter: drop-shadow(0 0 15px #2196f3) drop-shadow(0 4px 6px rgba(0,0,0,0.4));
  }
  .policeCar::before {
    content: "ğŸš¨";
    position: absolute;
    top: -0.5em;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.4em;
    animation: sirenBlink 0.5s infinite alternate;
  }
  @keyframes sirenBlink {
    0% { opacity: 0.3; filter: hue-rotate(0deg); }
    100% { opacity: 1; filter: hue-rotate(180deg); }
  }

  /* ğŸ†• Ğ­Ñ„Ñ„ĞµĞºÑ‚ ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ñ€Ğµ */
  .confetti {
    position: absolute;
    width: 8px;
    height: 8px;
    pointer-events: none;
    z-index: 100;
    animation: confettiFall 1s ease-out forwards;
  }
  @keyframes confettiFall {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0.3);
    }
  }

  /* ğŸ†• ĞšĞ¾Ğ¼Ğ±Ğ¾ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº */
  #comboCounter {
    position: absolute;
    top: 15%;
    right: 5%;
    font-size: clamp(1.5rem, 4vw, 3rem);
    font-weight: 900;
    color: #FFD700;
    text-shadow: 
      0 0 10px #FF6B6B,
      0 0 20px #FF6B6B,
      3px 3px 0 #000,
      -3px -3px 0 #000,
      3px -3px 0 #000,
      -3px 3px 0 #000;
    opacity: 0;
    transform: scale(0);
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    z-index: 50;
    pointer-events: none;
  }
  #comboCounter.active {
    opacity: 1;
    transform: scale(1);
  }
  #comboCounter.pulse {
    animation: comboPulse 0.3s ease-out;
  }
  @keyframes comboPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }

  /* ğŸ†• Ğ­Ñ„Ñ„ĞµĞºÑ‚ Ñ‚Ñ€ÑÑĞºĞ¸ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğ¸ */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
    20%, 40%, 60%, 80% { transform: translateX(10px); }
  }
  .shake {
    animation: shake 0.5s;
  }

  /* ğŸ†• ĞŸĞ»Ğ°Ğ²Ğ°ÑÑ‰Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¸ */
  .floating-score {
    position: absolute;
    font-size: clamp(1.2rem, 3vw, 2rem);
    font-weight: 900;
    color: #FFD700;
    text-shadow: 
      0 0 10px #4ECDC4,
      2px 2px 0 #000,
      -2px -2px 0 #000;
    pointer-events: none;
    z-index: 100;
    animation: floatUp 1.5s ease-out forwards;
  }
  @keyframes floatUp {
    0% {
      opacity: 1;
      transform: translateY(0) scale(0.5);
    }
    100% {
      opacity: 0;
      transform: translateY(-100px) scale(1.5);
    }
  }

  /* ğŸ†• Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ */
  #mainMenu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    text-align: center;
    z-index: 1000;
    font-weight: 700;
    user-select: none;
    color: #FFD700;
    background: 
      radial-gradient(circle at 30% 20%, rgba(106,13,173,0.4), transparent 50%),
      radial-gradient(circle at 70% 80%, rgba(255,107,107,0.3), transparent 50%),
      linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: clamp(0.5rem, 2vw, 2rem);
    box-sizing: border-box;
    overflow: hidden;
  }
  
  /* ğŸ†• ĞĞ½Ğ¸Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ†Ñ‹ Ğ½Ğ° Ñ„Ğ¾Ğ½Ğµ Ğ¼ĞµĞ½Ñ */
  #mainMenu::before {
    content: "";
    position: absolute;
    width: 200%;
    height: 200%;
    background-image: 
      radial-gradient(2px 2px at 20% 30%, white, transparent),
      radial-gradient(2px 2px at 60% 70%, white, transparent),
      radial-gradient(1px 1px at 50% 50%, white, transparent),
      radial-gradient(1px 1px at 80% 10%, white, transparent),
      radial-gradient(2px 2px at 90% 60%, white, transparent);
    background-size: 200px 200px;
    animation: particlesFloat 80s linear infinite;
    opacity: 0.4;
  }
  @keyframes particlesFloat {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
  }

  #mainMenu .menu-content {
    background: rgba(0, 0, 0, 0.8);
    border: 6px solid #FFD700;
    border-radius: clamp(15px, 2vw, 25px);
    padding: clamp(1.5rem, 4vw, 3rem);
    max-width: min(90vw, 600px);
    box-shadow: 
      0 0 30px rgba(255,215,0,0.5),
      0 20px 60px rgba(0,0,0,0.8),
      inset 0 0 20px rgba(255,215,0,0.2);
    position: relative;
    z-index: 1;
    backdrop-filter: blur(10px);
  }

  #mainMenu h1 {
    font-size: clamp(2rem, 6vw, 4rem);
    margin-bottom: clamp(0.5rem, 2vw, 1rem);
    background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientShift 3s ease infinite;
    text-shadow: none;
    filter: drop-shadow(0 4px 8px rgba(255,215,0,0.5));
  }
  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  #mainMenu .subtitle {
    font-size: clamp(0.9rem, 2.5vw, 1.2rem);
    margin-bottom: clamp(1.5rem, 3vw, 2.5rem);
    color: #4ECDC4;
    text-shadow: 0 0 10px rgba(78,205,196,0.5);
  }

  /* ğŸ†• ĞĞµĞ¾Ğ½Ğ¾Ğ²Ñ‹Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ */
  #mainMenu button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: 4px solid #000;
    padding: clamp(0.8rem, 2vw, 1.2rem) clamp(1.5rem, 4vw, 2.5rem);
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    font-weight: 900;
    border-radius: clamp(10px, 1.5vw, 15px);
    cursor: pointer;
    margin: clamp(0.4rem, 1vw, 0.6rem);
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    box-shadow: 
      0 6px 0 0 #000,
      0 8px 20px rgba(0,0,0,0.4),
      0 0 20px rgba(102,126,234,0.5);
    position: relative;
    overflow: hidden;
  }
  
  #mainMenu button::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }
  
  #mainMenu button:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 
      0 10px 0 0 #000,
      0 12px 30px rgba(0,0,0,0.5),
      0 0 40px rgba(102,126,234,0.8);
  }
  
  #mainMenu button:hover::before {
    width: 300px;
    height: 300px;
  }
  
  #mainMenu button:active {
    transform: translateY(2px) scale(1);
    box-shadow: 
      0 2px 0 0 #000,
      0 4px 10px rgba(0,0,0,0.3);
  }

  /* ğŸ†• Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ HUD */
  #hud {
    position: absolute;
    top: 2%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: clamp(0.8rem, 2vw, 1.5rem);
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    font-weight: 900;
    z-index: 100;
    pointer-events: none;
  }

  .hud-item {
    background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(0,0,0,0.7));
    padding: clamp(0.5rem, 1.5vw, 0.8rem) clamp(0.8rem, 2vw, 1.2rem);
    border-radius: clamp(10px, 1.5vw, 15px);
    border: 4px solid #FFD700;
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.5),
      inset 0 0 20px rgba(255,215,0,0.2),
      0 0 20px rgba(255,215,0,0.4);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    backdrop-filter: blur(10px);
  }

  .hud-item .icon {
    font-size: 1.2em;
    filter: drop-shadow(0 0 5px currentColor);
  }

  .hud-item .value {
    color: #FFD700;
    text-shadow: 
      0 0 10px #FFD700,
      2px 2px 0 #000,
      -2px -2px 0 #000;
    min-width: 3ch;
    text-align: right;
  }

  /* ğŸ†• ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿ÑƒĞ»ÑŒÑĞ°Ñ†Ğ¸Ğ¸ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ¹ Ğ¿Ñ€Ğ¸ ÑƒÑ€Ğ¾Ğ½Ğµ */
  .hud-item.lives.damaged {
    animation: livesPulse 0.5s ease-out;
  }
  @keyframes livesPulse {
    0%, 100% { 
      border-color: #FFD700;
      box-shadow: 
        0 4px 15px rgba(0,0,0,0.5),
        inset 0 0 20px rgba(255,215,0,0.2),
        0 0 20px rgba(255,215,0,0.4);
    }
    50% { 
      border-color: #FF6B6B;
      box-shadow: 
        0 4px 15px rgba(255,107,107,0.8),
        inset 0 0 20px rgba(255,107,107,0.3),
        0 0 30px rgba(255,107,107,0.8);
    }
  }

  /* ĞŸĞ°ÑƒĞ·Ğ° */
  #pauseOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }
  #pauseOverlay.active {
    display: flex;
  }
  #pauseOverlay .pause-content {
    background: linear-gradient(135deg, rgba(26,26,46,0.95), rgba(15,52,96,0.95));
    border: 6px solid #FFD700;
    border-radius: 25px;
    padding: 3rem 2rem;
    text-align: center;
    box-shadow: 
      0 0 40px rgba(255,215,0,0.6),
      0 20px 60px rgba(0,0,0,0.9);
  }
  #pauseOverlay h2 {
    font-size: clamp(2rem, 5vw, 3rem);
    color: #FFD700;
    margin-bottom: 2rem;
    text-shadow: 0 0 20px rgba(255,215,0,0.8);
  }

  /* Game Over */
  #gameOver {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, rgba(26,26,46,0.98), rgba(15,52,96,0.98));
    border: 6px solid #FFD700;
    border-radius: 25px;
    padding: clamp(2rem, 4vw, 3rem);
    text-align: center;
    z-index: 1001;
    min-width: min(90vw, 400px);
    box-shadow: 
      0 0 50px rgba(255,215,0,0.6),
      0 30px 80px rgba(0,0,0,0.9),
      inset 0 0 30px rgba(255,215,0,0.1);
    backdrop-filter: blur(15px);
  }
  #gameOver.active {
    display: block;
    animation: gameOverAppear 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }
  @keyframes gameOverAppear {
    0% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    100% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
  }
  #gameOver h2 {
    font-size: clamp(2rem, 5vw, 3rem);
    color: #FF6B6B;
    margin-bottom: 1.5rem;
    text-shadow: 0 0 20px rgba(255,107,107,0.8);
  }
  #gameOver .final-score {
    font-size: clamp(3rem, 8vw, 5rem);
    color: #FFD700;
    margin: 1rem 0;
    text-shadow: 
      0 0 30px #FFD700,
      4px 4px 0 #000,
      -4px -4px 0 #000;
  }

  /* ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ² */
  @media (max-width: 767px) {
    #courier {
      animation: none;
    }
    .speed-lines {
      display: none;
    }
    .stars {
      animation-duration: 120s;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
</head>
<body>

<div id="container">
  <!-- ğŸ†• ĞŸĞ°Ñ€Ğ°Ğ»Ğ»Ğ°ĞºÑ Ñ„Ğ¾Ğ½ -->
  <div class="parallax-bg">
    <div class="stars"></div>
  </div>

  <!-- Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ¿Ğ¾Ğ»Ğ¾ÑĞ° -->
  <div class="city-strip">
    <div class="scrolling-objects">
      ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢
    </div>
  </div>

  <!-- Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ -->
  <div id="game">
    <!-- ğŸ†• Ğ›Ğ¸Ğ½Ğ¸Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ -->
    <div class="speed-lines"></div>
    
    <!-- ĞŸĞ¾Ğ»Ğ¾ÑÑ‹ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ -->
    <div class="lane" data-lane="0"></div>
    <div class="lane" data-lane="1"></div>
    <div class="lane" data-lane="2"></div>
    <div class="lane" data-lane="3"></div>
    <div class="lane" data-lane="4"></div>

    <!-- ĞšÑƒÑ€ÑŒĞµÑ€ -->
    <div id="courier">
      <span id="helmet"></span>
      <span id="dog">ğŸ•</span>
      <span id="scooter">ğŸ›µ</span>
    </div>

    <!-- ĞĞ±Ğ»Ğ°Ñ‡ĞºĞ¾ Ñ€ĞµÑ‡Ğ¸ -->
    <div id="speechBubble"></div>

    <!-- ğŸ†• ĞšĞ¾Ğ¼Ğ±Ğ¾ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº -->
    <div id="comboCounter">
      <span class="combo-text">COMBO Ã—<span id="comboValue">0</span></span>
      <div class="combo-fire">ğŸ”¥</div>
    </div>

    <!-- ğŸ†• HUD -->
    <div id="hud">
      <div class="hud-item score">
        <span class="icon">â­</span>
        <span class="value" id="scoreDisplay">0</span>
      </div>
      <div class="hud-item lives">
        <span class="icon">â¤ï¸</span>
        <span class="value" id="livesDisplay">3</span>
      </div>
    </div>
  </div>

  <!-- ĞĞ¸Ğ¶Ğ½ÑÑ Ğ¿Ğ¾Ğ»Ğ¾ÑĞ° -->
  <div class="city-strip">
    <div class="scrolling-objects">
      ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ ğŸŒ³ğŸ˜ï¸ğŸŒ²ğŸ¢
    </div>
  </div>
</div>

<!-- Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ -->
<div id="mainMenu">
  <div class="menu-content">
    <h1>ğŸ›µ ĞŸÑ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ĞºÑƒÑ€ÑŒĞµÑ€Ğ° ğŸ›µ</h1>
    <p class="subtitle">Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹, ÑƒĞºĞ»Ğ¾Ğ½ÑĞ¹ÑÑ Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹!</p>
    <button id="startBtn">ğŸš€ ĞĞĞ§ĞĞ¢Ğ¬ Ğ˜Ğ“Ğ Ğ£</button>
    <button id="howToPlayBtn">â“ ĞšĞĞš Ğ˜Ğ“Ğ ĞĞ¢Ğ¬</button>
    <div id="howToPlayContent" style="display:none; margin-top:1.5rem; text-align:left; font-size:clamp(0.8rem, 2vw, 1rem); line-height:1.6;">
      <p style="margin-bottom:0.8rem;"><strong>ğŸ® Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:</strong></p>
      <ul style="list-style:none; padding-left:0;">
        <li>âŒ¨ï¸ <strong>Ğ¡Ñ‚Ñ€ĞµĞ»ĞºĞ¸ â†‘â†“</strong> Ğ¸Ğ»Ğ¸ <strong>W/S</strong> - Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ</li>
        <li>ğŸ“± <strong>Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ²ĞµÑ€Ñ…/Ğ²Ğ½Ğ¸Ğ·</strong> - Ğ½Ğ° Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ…</li>
        <li>â¸ï¸ <strong>ESC Ğ¸Ğ»Ğ¸ P</strong> - Ğ¿Ğ°ÑƒĞ·Ğ°</li>
      </ul>
      <p style="margin:1rem 0 0.5rem;"><strong>ğŸ¯ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°:</strong></p>
      <ul style="list-style:none; padding-left:0;">
        <li>ğŸ• <strong>Ğ•Ğ´Ğ°</strong> - ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ´Ğ»Ñ Ğ¾Ñ‡ĞºĞ¾Ğ²!</li>
        <li>â¤ï¸ <strong>ĞĞ¿Ñ‚ĞµÑ‡ĞºĞ°</strong> - Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¶Ğ¸Ğ·Ğ½ÑŒ</li>
        <li>ğŸ’ <strong>Ğ‘Ğ¾Ğ½ÑƒÑ</strong> - Ğ´Ğ²Ğ¾Ğ¹Ğ½Ñ‹Ğµ Ğ¾Ñ‡ĞºĞ¸!</li>
        <li>ğŸš” <strong>ĞŸĞ¾Ğ»Ğ¸Ñ†Ğ¸Ñ</strong> - Ğ¸Ğ·Ğ±ĞµĞ³Ğ°Ğ¹ ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğ¹!</li>
        <li>ğŸš¶ <strong>ĞŸĞµÑˆĞµÑ…Ğ¾Ğ´Ñ‹</strong> - Ğ¾Ğ±ÑŠĞµĞ·Ğ¶Ğ°Ğ¹ Ğ¸Ñ…!</li>
      </ul>
      <p style="margin-top:1rem; color:#4ECDC4;"><strong>âœ¨ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ¾Ğ¼Ğ±Ğ¾ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ½ÑƒÑĞ½Ñ‹Ñ… Ğ¾Ñ‡ĞºĞ¾Ğ²!</strong></p>
    </div>
  </div>
</div>

<!-- ĞŸĞ°ÑƒĞ·Ğ° -->
<div id="pauseOverlay">
  <div class="pause-content">
    <h2>â¸ï¸ ĞŸĞĞ£Ğ—Ğ</h2>
    <button id="resumeBtn">â–¶ï¸ ĞŸĞ ĞĞ”ĞĞ›Ğ–Ğ˜Ğ¢Ğ¬</button>
    <button id="restartFromPauseBtn">ğŸ”„ ĞĞĞ§ĞĞ¢Ğ¬ Ğ—ĞĞĞĞ’Ğ</button>
    <button id="exitToMenuBtn">ğŸ  Ğ’ ĞœĞ•ĞĞ®</button>
  </div>
</div>

<!-- Game Over -->
<div id="gameOver">
  <h2>ğŸ’¥ Ğ˜Ğ“Ğ Ğ ĞĞšĞĞĞ§Ğ•ĞĞ</h2>
  <div class="final-score" id="finalScore">0</div>
  <p style="color:#4ECDC4; font-size:clamp(1rem, 2.5vw, 1.3rem); margin:1rem 0;">Ğ¢Ğ²Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½!</p>
  <button id="restartBtn">ğŸ”„ Ğ•Ğ©Ğ• Ğ ĞĞ—</button>
  <button id="menuBtn">ğŸ  Ğ’ ĞœĞ•ĞĞ®</button>
</div>

<script>
// ========== Ğ˜Ğ“Ğ ĞĞ’ĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ ==========

const game = {
  state: 'menu', // 'menu', 'playing', 'paused', 'gameOver'
  score: 0,
  lives: 3,
  combo: 0,
  maxCombo: 0,
  speed: 5,
  spawnInterval: 1500,
  currentLane: 2,
  lastSpawn: 0,
  objects: [],
  animationId: null,
  lastDustTime: 0,
  speedLinesActive: false,
};

const DOM = {
  mainMenu: document.getElementById('mainMenu'),
  startBtn: document.getElementById('startBtn'),
  howToPlayBtn: document.getElementById('howToPlayBtn'),
  howToPlayContent: document.getElementById('howToPlayContent'),
  gameContainer: document.getElementById('game'),
  courier: document.getElementById('courier'),
  speechBubble: document.getElementById('speechBubble'),
  scoreDisplay: document.getElementById('scoreDisplay'),
  livesDisplay: document.getElementById('livesDisplay'),
  comboCounter: document.getElementById('comboCounter'),
  comboValue: document.getElementById('comboValue'),
  pauseOverlay: document.getElementById('pauseOverlay'),
  resumeBtn: document.getElementById('resumeBtn'),
  restartFromPauseBtn: document.getElementById('restartFromPauseBtn'),
  exitToMenuBtn: document.getElementById('exitToMenuBtn'),
  gameOver: document.getElementById('gameOver'),
  finalScore: document.getElementById('finalScore'),
  restartBtn: document.getElementById('restartBtn'),
  menuBtn: document.getElementById('menuBtn'),
  speedLines: document.querySelector('.speed-lines'),
  livesHUD: document.querySelector('.hud-item.lives'),
};

const lanes = [0, 1, 2, 3, 4];
const laneElements = document.querySelectorAll('.lane');

// ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»Ğ¾Ñ
function getLaneY(lane) {
  const laneEl = laneElements[lane];
  return laneEl.offsetTop + laneEl.offsetHeight / 2;
}

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ ĞºÑƒÑ€ÑŒĞµÑ€Ğ°
function updateCourierPosition() {
  const y = getLaneY(game.currentLane);
  DOM.courier.style.top = `${y}px`;
  DOM.courier.style.transform = `translateY(-50%) scaleX(-1)`;
}

// ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ† Ğ¿Ñ‹Ğ»Ğ¸
function createDustParticles() {
  const now = Date.now();
  if (now - game.lastDustTime < 100) return;
  game.lastDustTime = now;

  const courierRect = DOM.courier.getBoundingClientRect();
  const gameRect = DOM.gameContainer.getBoundingClientRect();

  for (let i = 0; i < 2; i++) {
    const dust = document.createElement('div');
    dust.className = 'dust-particle';
    dust.style.left = `${courierRect.left - gameRect.left + courierRect.width}px`;
    dust.style.top = `${courierRect.top - gameRect.top + courierRect.height / 2 + (Math.random() - 0.5) * 20}px`;
    DOM.gameContainer.appendChild(dust);

    setTimeout(() => dust.remove(), 600);
  }
}

// ğŸ†• Ğ›Ğ¸Ğ½Ğ¸Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸
function updateSpeedLines() {
  if (game.score > 100 && !game.speedLinesActive) {
    game.speedLinesActive = true;
    DOM.speedLines.style.opacity = '0.6';
    
    for (let i = 0; i < 5; i++) {
      const line = document.createElement('div');
      line.className = 'speed-line';
      line.style.top = `${20 + i * 20}%`;
      line.style.animationDelay = `${i * 0.1}s`;
      DOM.speedLines.appendChild(line);
    }
  } else if (game.score <= 100 && game.speedLinesActive) {
    game.speedLinesActive = false;
    DOM.speedLines.style.opacity = '0';
    DOM.speedLines.innerHTML = '';
  }
}

// Ğ”Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ ĞºÑƒÑ€ÑŒĞµÑ€Ğ°
function moveCourier(direction) {
  const newLane = game.currentLane + direction;
  if (newLane >= 0 && newLane < lanes.length) {
    game.currentLane = newLane;
    updateCourierPosition();
    createDustParticles();
  }
}

// ĞŸĞ¾ĞºĞ°Ğ· Ñ€ĞµÑ‡Ğ¸ ĞºÑƒÑ€ÑŒĞµÑ€Ğ°
function showSpeech(text) {
  DOM.speechBubble.textContent = text;
  const courierRect = DOM.courier.getBoundingClientRect();
  const gameRect = DOM.gameContainer.getBoundingClientRect();
  
  DOM.speechBubble.style.left = `${courierRect.left - gameRect.left + courierRect.width + 20}px`;
  DOM.speechBubble.style.top = `${courierRect.top - gameRect.top - 10}px`;
  DOM.speechBubble.style.opacity = '1';

  setTimeout(() => {
    DOM.speechBubble.style.opacity = '0';
  }, 2000);
}

// ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸
function createConfetti(x, y, color) {
  for (let i = 0; i < 10; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = `${x}px`;
    confetti.style.top = `${y}px`;
    confetti.style.background = ['#FFD700', '#FF6B6B', '#4ECDC4', '#95E1D3'][Math.floor(Math.random() * 4)];
    confetti.style.setProperty('--tx', `${(Math.random() - 0.5) * 200}px`);
    confetti.style.setProperty('--ty', `${(Math.random() - 0.5) * 200}px`);
    DOM.gameContainer.appendChild(confetti);

    setTimeout(() => confetti.remove(), 1000);
  }
}

// ğŸ†• ĞŸĞ»Ğ°Ğ²Ğ°ÑÑ‰Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¸
function showFloatingScore(points, x, y) {
  const floatingScore = document.createElement('div');
  floatingScore.className = 'floating-score';
  floatingScore.textContent = `+${points}`;
  floatingScore.style.left = `${x}px`;
  floatingScore.style.top = `${y}px`;
  DOM.gameContainer.appendChild(floatingScore);

  setTimeout(() => floatingScore.remove(), 1500);
}

// ğŸ†• ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ±Ğ¾
function updateCombo(increase = true) {
  if (increase) {
    game.combo++;
    if (game.combo > game.maxCombo) game.maxCombo = game.combo;
    
    if (game.combo >= 3) {
      DOM.comboCounter.classList.add('active', 'pulse');
      DOM.comboValue.textContent = game.combo;
      setTimeout(() => DOM.comboCounter.classList.remove('pulse'), 300);
    }
  } else {
    game.combo = 0;
    DOM.comboCounter.classList.remove('active');
  }
}

// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²
function spawnObject() {
  const now = Date.now();
  if (now - game.lastSpawn < game.spawnInterval) return;
  game.lastSpawn = now;

  const lane = Math.floor(Math.random() * lanes.length);
  const types = [
    { emoji: 'ğŸ•', class: 'food', points: 10 },
    { emoji: 'ğŸ”', class: 'food', points: 10 },
    { emoji: 'ğŸŒ®', class: 'food', points: 10 },
    { emoji: 'ğŸš¶', class: 'pedestrian', points: -1 },
    { emoji: 'ğŸš¶â€â™€ï¸', class: 'pedestrian', points: -1 },
    { emoji: 'ğŸš”', class: 'policeCar', points: -1 },
    { emoji: 'ğŸ‘®', class: 'policeStanding', points: -1 },
    { emoji: 'ğŸ’Š', class: 'medkit', points: 0 },
    { emoji: 'ğŸ’', class: 'bonus', points: 50 },
  ];

  const type = types[Math.floor(Math.random() * types.length)];
  
  const obj = document.createElement('div');
  obj.className = type.class;
  obj.textContent = type.emoji;
  obj.dataset.lane = lane;
  obj.dataset.points = type.points;
  obj.style.left = '100%';
  obj.style.top = `${getLaneY(lane)}px`;
  obj.style.transform = 'translateY(-50%)';

  laneElements[lane].appendChild(obj);
  game.objects.push({ el: obj, lane, type: type.class, points: type.points });
}

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²
function updateObjects() {
  game.objects = game.objects.filter(obj => {
    const currentLeft = parseFloat(obj.el.style.left);
    const newLeft = currentLeft - game.speed;

    if (newLeft < -10) {
      obj.el.remove();
      return false;
    }

    obj.el.style.left = `${newLeft}%`;

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğ¹
    if (newLeft < 15 && newLeft > 5 && obj.lane === game.currentLane) {
      handleCollision(obj);
      obj.el.remove();
      return false;
    }

    return true;
  });
}

// ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğ¹
function handleCollision(obj) {
  const courierRect = DOM.courier.getBoundingClientRect();
  const gameRect = DOM.gameContainer.getBoundingClientRect();
  const x = courierRect.left - gameRect.left + courierRect.width / 2;
  const y = courierRect.top - gameRect.top + courierRect.height / 2;

  if (obj.type === 'food') {
    const bonusPoints = game.combo >= 3 ? obj.points * 2 : obj.points;
    game.score += bonusPoints;
    updateCombo(true);
    showSpeech(['Ğ’ĞºÑƒÑĞ½Ğ¾! ğŸ˜‹', 'ĞÑĞ¼-Ğ½ÑĞ¼! ğŸ•', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ğŸ‘'][Math.floor(Math.random() * 3)]);
    createConfetti(x, y);
    showFloatingScore(bonusPoints, x, y);
    updateScore();
  } else if (obj.type === 'medkit') {
    if (game.lives < 3) {
      game.lives++;
      updateLives();
      showSpeech('Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾! â¤ï¸');
      createConfetti(x, y);
    }
  } else if (obj.type === 'bonus') {
    game.score += obj.points;
    updateCombo(true);
    showSpeech('Ğ‘Ğ¾Ğ½ÑƒÑ! ğŸ’');
    createConfetti(x, y);
    showFloatingScore(obj.points, x, y);
    updateScore();
  } else {
    // Ğ¡Ñ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸ĞµĞ¼
    game.lives--;
    updateCombo(false);
    updateLives();
    showSpeech(['ĞĞ¹! ğŸ˜µ', 'Ğ£Ğ¿Ñ! ğŸ˜¬', 'Ğ‘Ğ¾Ğ»ÑŒĞ½Ğ¾! ğŸ¤•'][Math.floor(Math.random() * 3)]);
    DOM.gameContainer.classList.add('shake');
    DOM.livesHUD.classList.add('damaged');
    setTimeout(() => {
      DOM.gameContainer.classList.remove('shake');
      DOM.livesHUD.classList.remove('damaged');
    }, 500);

    if (game.lives <= 0) {
      endGame();
    }
  }
}

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‡ĞµÑ‚Ğ°
function updateScore() {
  DOM.scoreDisplay.textContent = game.score;
  
  // Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸
  game.speed = 5 + Math.floor(game.score / 100);
  game.spawnInterval = Math.max(800, 1500 - Math.floor(game.score / 50) * 100);
  
  updateSpeedLines();
}

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ¹
function updateLives() {
  DOM.livesDisplay.textContent = game.lives;
}

// Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ»
function gameLoop() {
  if (game.state !== 'playing') return;

  spawnObject();
  updateObjects();
  createDustParticles();

  game.animationId = requestAnimationFrame(gameLoop);
}

// ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¸Ğ³Ñ€Ñ‹
function startGame() {
  game.state = 'playing';
  game.score = 0;
  game.lives = 3;
  game.combo = 0;
  game.maxCombo = 0;
  game.speed = 5;
  game.spawnInterval = 1500;
  game.currentLane = 2;
  game.objects.forEach(obj => obj.el.remove());
  game.objects = [];
  
  DOM.mainMenu.style.display = 'none';
  DOM.gameOver.classList.remove('active');
  DOM.pauseOverlay.classList.remove('active');
  DOM.comboCounter.classList.remove('active');
  
  updateScore();
  updateLives();
  updateCourierPosition();
  
  gameLoop();
}

// ĞšĞ¾Ğ½ĞµÑ† Ğ¸Ğ³Ñ€Ñ‹
function endGame() {
  game.state = 'gameOver';
  cancelAnimationFrame(game.animationId);
  
  DOM.finalScore.textContent = game.score;
  DOM.gameOver.classList.add('active');

  // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° Ğ² Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ Ğ¾ĞºĞ½Ğ¾
  window.parent.postMessage({
    type: 'GAME_OVER',
    score: game.score,
  }, '*');
}

// ĞŸĞ°ÑƒĞ·Ğ°
function togglePause() {
  if (game.state === 'playing') {
    game.state = 'paused';
    cancelAnimationFrame(game.animationId);
    DOM.pauseOverlay.classList.add('active');
  } else if (game.state === 'paused') {
    game.state = 'playing';
    DOM.pauseOverlay.classList.remove('active');
    gameLoop();
  }
}

// Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ² Ğ¼ĞµĞ½Ñ
function returnToMenu() {
  game.state = 'menu';
  cancelAnimationFrame(game.animationId);
  game.objects.forEach(obj => obj.el.remove());
  game.objects = [];
  game.speedLinesActive = false;
  DOM.speedLines.style.opacity = '0';
  DOM.speedLines.innerHTML = '';
  
  DOM.mainMenu.style.display = 'flex';
  DOM.gameOver.classList.remove('active');
  DOM.pauseOverlay.classList.remove('active');
  DOM.comboCounter.classList.remove('active');
}

// ========== Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ ==========

// ĞœĞµĞ½Ñ
DOM.startBtn.addEventListener('click', startGame);
DOM.howToPlayBtn.addEventListener('click', () => {
  const content = DOM.howToPlayContent;
  content.style.display = content.style.display === 'none' ? 'block' : 'none';
  DOM.howToPlayBtn.textContent = content.style.display === 'none' ? 'â“ ĞšĞĞš Ğ˜Ğ“Ğ ĞĞ¢Ğ¬' : 'âœ–ï¸ Ğ—ĞĞšĞ Ğ«Ğ¢Ğ¬';
});

// ĞŸĞ°ÑƒĞ·Ğ°
DOM.resumeBtn.addEventListener('click', togglePause);
DOM.restartFromPauseBtn.addEventListener('click', () => {
  DOM.pauseOverlay.classList.remove('active');
  startGame();
});
DOM.exitToMenuBtn.addEventListener('click', returnToMenu);

// Game Over
DOM.restartBtn.addEventListener('click', startGame);
DOM.menuBtn.addEventListener('click', returnToMenu);

// Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ¾Ğ¹
document.addEventListener('keydown', (e) => {
  if (game.state === 'playing') {
    if (e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') {
      e.preventDefault();
      moveCourier(-1);
    } else if (e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') {
      e.preventDefault();
      moveCourier(1);
    } else if (e.key === 'Escape' || e.key === 'p' || e.key === 'P') {
      e.preventDefault();
      togglePause();
    }
  } else if (game.state === 'paused') {
    if (e.key === 'Escape' || e.key === 'p' || e.key === 'P') {
      e.preventDefault();
      togglePause();
    }
  }
});

// Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ²Ğ°Ğ¹Ğ¿Ğ°Ğ¼Ğ¸ (Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ)
let touchStartY = 0;
DOM.gameContainer.addEventListener('touchstart', (e) => {
  if (game.state === 'playing') {
    touchStartY = e.touches[0].clientY;
  }
}, { passive: true });

DOM.gameContainer.addEventListener('touchend', (e) => {
  if (game.state !== 'playing') return;
  
  const touchEndY = e.changedTouches[0].clientY;
  const diff = touchStartY - touchEndY;

  if (Math.abs(diff) > 30) {
    if (diff > 0) {
      moveCourier(-1); // Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ²ĞµÑ€Ñ…
    } else {
      moveCourier(1); // Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ²Ğ½Ğ¸Ğ·
    }
  }
}, { passive: true });

// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
updateCourierPosition();
console.log('ğŸ® Ğ˜Ğ³Ñ€Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ°! ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ!');
</script>

</body>
</html>
