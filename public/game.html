<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞</title>

<!-- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ -->
<link rel="preload" href="https://cdn.poehali.dev/files/d91aa39a-b906-481f-95ef-6c750cb6a76a.png" as="image" />
<link rel="preload" href="https://cdn.poehali.dev/files/6f16d2d4-f371-4b0f-a43e-c70a6de7b033.jpg" as="image" />

<style>
  /* --- –°–±—Ä–æ—Å –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ --- */
  *, *::before, *::after {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  html, body {
    height: 100%;
    width: 100%;
    overflow: hidden;
    font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
    background: #000;
    color: #FFD700;
    user-select: none;
  }
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* --- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã --- */
  #container {
    flex: 1 1 auto;
    width: 100vw;
    max-width: 100vw;
    max-height: 100vh;
    display: flex;
    flex-direction: column;
    background: transparent;
  }

  /* --- –í–µ—Ä—Ö–Ω—è—è –∏ –Ω–∏–∂–Ω—è—è –ø–æ–ª–æ—Å—ã —Å –ª–µ—Å–æ–º --- */
  .city-strip {
    flex-shrink: 0;
    height: clamp(3rem, 8vw, 5rem);
    background: linear-gradient(to bottom, #2e7d32, #145214);
    overflow: hidden;
    position: relative;
    font-size: clamp(2rem, 6vw, 3rem);
    line-height: clamp(3rem, 8vw, 5rem);
    white-space: nowrap;
    color: #a5d6a7;
  }
  .scrolling-objects {
    position: absolute;
    top: 0; left: 0;
    height: 100%;
    width: 200%;
    white-space: nowrap;
    animation: scrollLeft 20s linear infinite;
    font-size: clamp(2rem, 6vw, 3rem);
  }
  @keyframes scrollLeft {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* --- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ —Å 5 –ø–æ–ª–æ—Å–∞–º–∏ --- */
  #game {
    flex: 1 1 auto;
    position: relative;
    width: 100%;
    max-width: 100vw;
    height: 100%;
    max-height: calc(100vh - 2 * clamp(3rem, 8vw, 5rem));
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    padding: 0 1vw;
    background: 
      linear-gradient(90deg, transparent 0%, rgba(0,0,0,0.1) 50%, transparent 100%),
      linear-gradient(#4a4a5a 10%, #3d3d4d 50%, #4a4a5a 90%);
    box-shadow: 
      inset 0 0 50px rgba(0, 0, 0, 0.6),
      inset 0 10px 30px rgba(0, 0, 0, 0.3);
  }
  
  /* üÜï –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã —Å–æ —Å—Ç–æ–ª–±–∏–∫–∞–º–∏ */
  .traffic-light {
    position: absolute;
    font-size: clamp(2rem, 4vw, 2.5rem);
    z-index: 5;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }
  .traffic-light-pole {
    width: 4px;
    height: 2em;
    background: linear-gradient(to bottom, #555, #333);
    border-radius: 2px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  .lane {
    flex: 1;
    position: relative;
    border: none;
    background: transparent;
    overflow: visible;
  }
  .lane::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 6px;
    background:
      repeating-linear-gradient(
        to right,
        white 0,
        white 20px,
        transparent 20px,
        transparent 40px
      );
    opacity: 0.6;
    transform: translateY(-50%);
    animation: dashMove linear infinite;
    pointer-events: none;
    z-index: 2;
    animation-duration: 1s;
  }
  @keyframes dashMove {
    0% {
      background-position: 0 0;
    }
    100% {
      background-position: -40px 0;
    }
  }

  /* --- –ö—É—Ä—å–µ—Ä —Å —Å–æ–±–∞–∫–æ–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏—è --- */
  #courier {
    position: absolute;
    left: 10%;
    font-size: clamp(3rem, 8vw, 4rem);
    user-select: none;
    pointer-events: none;
    z-index: 10;
    text-shadow: 1px 1px 0.2vw #2e1b0c;
    transform-origin: center bottom;
    width: 1em;
    height: 1em;
    transform-origin: center bottom;
    transform-style: preserve-3d;
    transform-box: fill-box;
    transform: scaleX(-1);
    transition: top 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: top;
  }
  /* –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
  @media (max-width: 767px) {
    #courier {
      animation: none;
    }
  }
  @media (min-width: 768px) {
    #courier {
      animation: sway 2s ease-in-out infinite;
    }
  }
  @keyframes sway {
    0%, 100% { transform: scaleX(-1) translateX(0) rotate(0deg); }
    25% { transform: scaleX(-1) translateX(-0.1em) rotate(-3deg); }
    50% { transform: scaleX(-1) translateX(0) rotate(0deg); }
    75% { transform: scaleX(-1) translateX(0.1em) rotate(3deg); }
  }
  #dog {
    position: absolute;
    top: 0;
    left: 0.6em;
    font-size: 0.625em;
    opacity: 0.7;
    user-select: none;
    pointer-events: none;
    z-index: 0;
    animation: rideDog 1s ease-in-out infinite;
    transform-origin: center center;
  }
  #helmet {
    position: absolute;
    top: 0.1em;
    left: 0.6em;
    width: 0.2em;
    height: 0.15em;
    background: gold;
    border-radius: 1rem 1rem 0 0;
    box-shadow: inset 0 -0.3rem 0.2rem #cc9f00;
    z-index: 0;
    animation: rideDog 1s ease-in-out infinite;
  }
  #scooter {
    position: relative;
    z-index: 1;
    user-select: none;
    pointer-events: none;
    animation: rideScooter 1s ease-in-out infinite;
    transform-origin: center bottom;
  }
  @keyframes rideScooter {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-0.3rem) rotate(-3deg); }
    50% { transform: translateY(0) rotate(0deg); }
    75% { transform: translateY(-0.3rem) rotate(3deg); }
  }
  @keyframes rideDog {
    0%, 100% { transform: translateY(0); }
    25% { transform: translateY(-0.2rem); }
    50% { transform: translateY(0); }
    75% { transform: translateY(-0.2rem); }
  }

  /* üÜï –§–∞—Ä–∞ —Å–∞–º–æ–∫–∞—Ç–∞ - –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –≤—ã—Å–æ—Ç—ã */
  #courier::before {
    content: "";
    position: absolute;
    left: -1em;
    top: 0.5em;
    width: 2.5em;
    height: 0.4em;
    background: radial-gradient(ellipse at left, rgba(255, 255, 150, 0.7), rgba(255, 255, 150, 0.3) 50%, transparent 70%);
    pointer-events: none;
    z-index: -1;
    animation: headlightPulse 2s ease-in-out infinite;
    filter: blur(2px);
  }
  @keyframes headlightPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 0.85; }
  }

  /* üÜï –ß–∞—Å—Ç–∏—Ü—ã –ø—ã–ª–∏ –∏–∑-–ø–æ–¥ –∫–æ–ª–µ—Å */
  .dust-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(150, 150, 150, 0.6);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
    animation: dustFloat 0.8s ease-out forwards;
  }
  @keyframes dustFloat {
    0% {
      opacity: 1;
      transform: translate(0, 0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(-40px, 15px) scale(0.2);
    }
  }

  /* --- –û–±–ª–∞–∫–æ —Ä–µ—á–∏ –∫—É—Ä—å–µ—Ä–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ) --- */
  #speechBubble {
    position: absolute;
    background: #222c;
    color: #fff;
    padding: 0.4rem 0.8rem;
    border-radius: 0.6rem;
    font-size: clamp(0.8rem, 2vw, 1rem);
    max-width: 90vw;
    width: auto;
    pointer-events: none;
    user-select: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    box-shadow: 0 0 0.3rem #000a;
    z-index: 20;
    font-weight: 600;
    white-space: nowrap;
  }
  #speechBubble::after {
    content: "";
    position: absolute;
    bottom: -0.4rem;
    left: 50%;
    transform: translateX(-50%);
    border-width: 0.4rem 0.4rem 0 0.4rem;
    border-style: solid;
    border-color: #222c transparent transparent transparent;
  }

  /* --- –û–±—ä–µ–∫—Ç—ã (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) --- */
  .pedestrian, .food, .medkit, .bonus, .policeCar, .policeStanding {
    position: absolute;
    font-size: clamp(2rem, 6vw, 3rem);
    user-select: none;
    pointer-events: none;
    z-index: 5;
    text-shadow: 1px 1px 0.1vw #422d1f;
    will-change: left;
  }
  
  /* –£–ø—Ä–æ—â–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
  @media (min-width: 768px) {
    .pedestrian {
      filter: drop-shadow(0 0 0.15rem #8b0000);
    }
    .food {
      filter: drop-shadow(0 0 0.2rem #ffd54f);
      animation: foodFloat 2s ease-in-out infinite;
    }
    .medkit {
      filter: drop-shadow(0 0 0.25rem #e57373);
      animation: medkitPulse 1s ease-in-out infinite;
    }
    .bonus {
      filter: drop-shadow(0 0 0.25rem #64b5f6);
      animation: bonusSpin 3s linear infinite;
    }
    .policeCar {
      filter: drop-shadow(0 0 0.3rem #2196f3);
    }
    .policeStanding {
      filter: drop-shadow(0 0 0.25rem #1565c0);
    }
  }
  
  @keyframes foodFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }
  @keyframes medkitPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  @keyframes bonusSpin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* üÜï –≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø—Ä–∏ —Å–±–æ—Ä–µ */
  .confetti {
    position: absolute;
    width: 8px;
    height: 8px;
    pointer-events: none;
    z-index: 100;
    animation: confettiFall 1s ease-out forwards;
    border-radius: 2px;
  }
  @keyframes confettiFall {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(var(--tx, -50px), var(--ty, 80px)) rotate(720deg) scale(0.3);
    }
  }

  /* üÜï –ü–ª–∞–≤–∞—é—â–∏–µ –æ—á–∫–∏ */
  .floating-score {
    position: absolute;
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 900;
    color: #FFD700;
    text-shadow: 
      0 0 10px #4ECDC4,
      3px 3px 0 #000,
      -3px -3px 0 #000,
      3px -3px 0 #000,
      -3px 3px 0 #000;
    pointer-events: none;
    z-index: 100;
    animation: floatUp 1.5s ease-out forwards;
  }
  @keyframes floatUp {
    0% {
      opacity: 1;
      transform: translateY(0) scale(0.5);
    }
    100% {
      opacity: 0;
      transform: translateY(-100px) scale(1.5);
    }
  }

  /* üÜï –≠—Ñ—Ñ–µ–∫—Ç —Ç—Ä—è—Å–∫–∏ –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
    20%, 40%, 60%, 80% { transform: translateX(10px); }
  }
  .shake {
    animation: shake 0.5s;
  }

  /* --- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é --- */
  #mainMenu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) !important;
    width: 100%;
    height: 100%;
    background: black;
    text-align: center;
    z-index: 1000;
    font-weight: 700;
    user-select: none;
    color: #FFD700;
    background-image: url('https://cdn.poehali.dev/files/6f16d2d4-f371-4b0f-a43e-c70a6de7b033.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: clamp(0.5rem, 2vw, 2rem);
    box-sizing: border-box;
    border: 6px solid #000;
    border-radius: clamp(10px, 2vw, 20px);
    box-shadow: 0 0 0 4px #FFD700, inset 0 0 0 2px #FFD700;
    margin: 0;
  }
  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –º–µ–Ω—é –≤ –µ–¥–∏–Ω–æ–π —Ä–∞–º–∫–µ */
  #mainMenu .menu-content {
    background: rgba(0, 0, 0, 0.7);
    border: 4px solid #000;
    border-radius: clamp(10px, 1rem, 16px);
    padding: clamp(1rem, 3vw, 2rem);
    max-width: min(95vw, 500px);
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: clamp(1rem, 2vw, 1.5rem);
    box-shadow: 0 6px 0 0 rgba(0, 0, 0, 1);
    backdrop-filter: blur(8px);
  }
  #mainMenu #menuLogo {
    margin-bottom: 0;
    width: 100%;
  }
  
  /* --- –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–≥—Ä—ã --- */
  #gameMarquee {
    width: 100%;
    background: linear-gradient(135deg, #FBBF24, #F59E0B);
    border: 3px solid #000;
    border-radius: clamp(8px, 0.8rem, 12px);
    overflow: hidden;
    margin: 0;
    padding: clamp(0.4rem, 1.5vw, 0.6rem) 0;
    font-weight: 900;
  }
  #gameMarquee .marquee-content {
    display: flex;
    align-items: center;
    animation: marqueeScroll 20s linear infinite;
    white-space: nowrap;
  }
  #gameMarquee .marquee-item {
    display: inline-flex;
    align-items: center;
    gap: clamp(0.3rem, 1vw, 0.5rem);
    padding: 0 clamp(1rem, 3vw, 2rem);
    font-size: clamp(0.85rem, 2.5vw, 1rem);
    font-weight: 900;
    color: #000;
    text-shadow: 1px 1px 0 rgba(255, 215, 0, 0.3);
  }
  @keyframes marqueeScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  #gameMarquee .emoji-icon {
    font-size: clamp(1rem, 3vw, 1.2rem);
  }
  #versionMenu {
    position: absolute;
    bottom: 0.5rem;
    left: 0.5rem;
    font-size: 0.9rem;
    color: #FFD700;
    opacity: 0.7;
    user-select: none;
    pointer-events: none;
  }
  #menuLogo {
    font-weight: 900;
    padding: clamp(0.75rem, 2vw, 1.5rem) clamp(1rem, 3vw, 2rem);
    border-radius: clamp(8px, 0.8rem, 12px);
    border: 3px solid #000;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(6px);
    box-shadow: 0 4px 0 0 rgba(0, 0, 0, 0.5);
  }
  #menuLogo .text {
    font-size: clamp(1.2rem, 4.5vw, 1.8rem);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: clamp(0.25rem, 1vw, 0.5rem);
  }
  #menuLogo .nd {
    font-size: clamp(1.5rem, 5vw, 2.2rem);
    line-height: 1.2;
  }
  #menuCharacter {
    font-size: clamp(2.5rem, 8vw, 3.5rem);
    user-select: none;
    position: relative;
    text-shadow: 1px 1px 0.2vw #2e1b0c;
    animation: sway 2s ease-in-out infinite;
    transform-origin: center bottom;
    transform-style: preserve-3d;
    transform-box: fill-box;
    transform: scaleX(-1);
  }
  #menuCharacter img {
    width: clamp(120px, 30vw, 200px) !important;
    height: clamp(120px, 30vw, 200px) !important;
  }
  #menuCharacter #dog {
    position: absolute;
    top: 0;
    left: 0.6em;
    font-size: 0.625em;
    opacity: 0.7;
    animation: rideDog 1s ease-in-out infinite;
    transform-origin: center center;
  }
  #menuCharacter #helmet {
    position: absolute;
    top: 0.1em;
    left: 0.6em;
    width: 0.2em;
    height: 0.15em;
    background: gold;
    border-radius: 1rem 1rem 0 0;
    box-shadow: inset 0 -0.3rem 0.2rem #cc9f00;
    animation: rideDog 1s ease-in-out infinite;
  }
  #menuCharacter #scooter {
    position: relative;
    z-index: 1;
    animation: rideScooter 1s ease-in-out infinite;
    transform-origin: center bottom;
  }
  #mainMenu button {
    margin: 0;
    font-size: clamp(0.9rem, 3.5vw, 1.2rem);
    padding: clamp(0.6rem, 2vw, 0.8rem) clamp(1rem, 4vw, 2rem);
    border: 3px solid #000;
    border-radius: clamp(8px, 0.6rem, 12px);
    background-color: #FBBF24;
    color: #000;
    cursor: pointer;
    width: 100%;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    min-height: 44px;
    font-weight: 900;
    box-shadow: 
      0 4px 0 0 rgba(0, 0, 0, 1),
      0 0 20px rgba(251, 191, 36, 0.5),
      inset 0 0 15px rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
  }
  #mainMenu button::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
    pointer-events: none;
  }
  #mainMenu button:hover,
  #mainMenu button:focus {
    background-color: #F59E0B;
    color: #000;
    outline: none;
    box-shadow: 
      0 6px 0 0 rgba(0, 0, 0, 1),
      0 0 35px rgba(251, 191, 36, 0.8),
      inset 0 0 20px rgba(255, 255, 255, 0.3);
    transform: translateY(-2px) scale(1.02);
  }
  #mainMenu button:hover::before {
    width: 300px;
    height: 300px;
  }
  #mainMenu button:active {
    background-color: #F59E0B;
    color: #000;
    outline: none;
    transform: translateY(4px) scale(1);
    box-shadow: 
      0 0 0 0 rgba(0, 0, 0, 1),
      0 0 15px rgba(251, 191, 36, 0.4);
  }
  
  /* –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É" */
  #becomeBtn {
    background-color: #dc2626 !important;
    color: #fff !important;
    border: 3px solid #000 !important;
    box-shadow: 
      0 4px 0 0 rgba(0, 0, 0, 1),
      0 0 25px rgba(220, 38, 38, 0.6),
      inset 0 0 15px rgba(255, 255, 255, 0.15) !important;
    font-weight: 900;
  }
  #becomeBtn:hover,
  #becomeBtn:focus {
    background-color: #b91c1c !important;
    color: #fff !important;
    box-shadow: 
      0 6px 0 0 rgba(0, 0, 0, 1),
      0 0 40px rgba(220, 38, 38, 0.9),
      inset 0 0 20px rgba(255, 255, 255, 0.2) !important;
    transform: translateY(-2px) scale(1.02);
  }
  #becomeBtn:active {
    background-color: #b91c1c !important;
    color: #fff !important;
    transform: translateY(4px) scale(1);
    box-shadow: 
      0 0 0 0 rgba(0, 0, 0, 1),
      0 0 15px rgba(220, 38, 38, 0.5) !important;
  }
  
  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é */
  #mainMenu .menu-buttons {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: clamp(0.75rem, 2vw, 1rem);
    width: 100%;
  }
  
  /* –§—É—Ç–µ—Ä –º–µ–Ω—é */
  #mainMenu .menu-footer {
    margin-top: auto;
    padding: clamp(0.75rem, 2vw, 1rem) clamp(1rem, 3vw, 1.5rem);
    background: rgba(0, 0, 0, 0.6);
    border-radius: clamp(8px, 0.8rem, 12px);
    border: clamp(1px, 0.15vw, 2px) solid rgba(255, 215, 0, 0.3);
    width: 100%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  }
  #mainMenu .menu-footer-icons {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(0.5rem, 2vw, 1rem);
    justify-content: center;
    align-items: center;
    font-size: clamp(0.7rem, 2.2vw, 0.9rem);
    margin-bottom: clamp(0.5rem, 1.5vw, 0.75rem);
  }
  #mainMenu .menu-footer-icon {
    display: flex;
    align-items: center;
    gap: clamp(0.25rem, 1vw, 0.4rem);
    color: #FFD700;
  }
  #mainMenu .menu-footer-icon svg {
    width: clamp(14px, 4vw, 18px);
    height: clamp(14px, 4vw, 18px);
    flex-shrink: 0;
  }
  #mainMenu .menu-footer-copyright {
    text-align: center;
    font-size: clamp(0.65rem, 1.8vw, 0.8rem);
    color: #FFD700;
    opacity: 0.8;
    border-top: 1px solid rgba(255, 215, 0, 0.2);
    padding-top: clamp(0.5rem, 1.5vw, 0.75rem);
  }
  #mainMenu .menu-footer-copyright p {
    margin: 0;
    line-height: 1.4;
  }

  /* --- –ú–µ–Ω—é –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã --- */
  #gameOverMenu {
    position: fixed;
    top: 50%;
    left: 50%;
    width: auto;
    height: auto;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(10px);
    border-radius: clamp(10px, 1rem, 16px);
    border: 4px solid #000;
    padding: clamp(1.5rem, 4vw, 2.5rem) clamp(1.5rem, 5vw, 3rem);
    box-shadow: 0 6px 0 0 rgba(0, 0, 0, 1), 0 0 0 2px #FFD700;
    text-align: center;
    z-index: 1100;
    font-size: clamp(1rem, 4vw, 1.4rem);
    font-weight: 900;
    user-select: none;
    margin: 0;
    color: #FFD700;
    display: none;
    max-width: min(90vw, 400px);
    width: auto;
    box-sizing: border-box;
  }
  #gameOverMenu button {
    margin: clamp(0.6rem, 2vw, 0.8rem) clamp(0.3rem, 1vw, 0.5rem) 0;
    font-size: clamp(0.9rem, 3.5vw, 1.1rem);
    padding: clamp(0.5rem, 2vw, 0.7rem) clamp(1rem, 4vw, 1.8rem);
    border: 3px solid #000;
    border-radius: clamp(8px, 0.6rem, 10px);
    background-color: #FBBF24;
    color: #000;
    cursor: pointer;
    min-height: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    transition: all 0.15s ease;
    font-weight: 900;
    box-shadow: 0 4px 0 0 rgba(0, 0, 0, 1);
  }
  #gameOverMenu button:hover,
  #gameOverMenu button:focus {
    background-color: #F59E0B;
    color: #000;
    outline: none;
    box-shadow: 0 2px 0 0 rgba(0, 0, 0, 1);
    transform: translateY(2px);
  }
  #gameOverMenu button:active {
    background-color: #F59E0B;
    color: #000;
    outline: none;
    transform: translateY(4px);
    box-shadow: none;
  }

  /* --- –ü—Ä–∞–≤–∏–ª–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ) --- */
  #rulesDialog {
    display: none;
    color: #fff;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(10px);
    padding: clamp(1rem, 3vw, 2rem);
    border-radius: clamp(10px, 1rem, 16px);
    border: 4px solid #000;
    max-width: min(95vw, 600px);
    margin: clamp(2vh, 4vh, 6vh) auto;
    overflow-y: auto;
    max-height: 90vh;
    position: fixed;
    inset: 0;
    z-index: 2000;
    box-shadow: 0 6px 0 0 rgba(0, 0, 0, 1), 0 0 0 2px #FFD700;
  }
  #rulesDialog h2 {
    color: #FFD700;
    text-align: center;
    margin-bottom: clamp(0.5rem, 2vw, 1rem);
    font-size: clamp(1.3rem, 5vw, 1.8rem);
    font-weight: 900;
    text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
  }
  #rulesDialog ul {
    line-height: 1.6;
    font-size: clamp(0.9rem, 3vw, 1.1rem);
    padding-left: clamp(1rem, 3vw, 1.5rem);
  }
  #rulesDialog ul li {
    margin-bottom: clamp(0.3rem, 1vw, 0.5rem);
  }
  #rulesDialog ul ul {
    font-size: clamp(0.85rem, 2.8vw, 1rem);
    padding-left: clamp(0.8rem, 2.5vw, 1.2rem);
    margin-top: clamp(0.25rem, 0.8vw, 0.4rem);
  }
  #rulesDialog button {
    background: #FBBF24;
    border: 3px solid #000;
    border-radius: clamp(8px, 0.8rem, 12px);
    padding: clamp(0.6rem, 2vw, 0.8rem) clamp(1.5rem, 4vw, 2rem);
    font-weight: 900;
    cursor: pointer;
    color: #000;
    display: block;
    margin: clamp(1rem, 3vw, 1.5rem) auto 0 auto;
    font-size: clamp(0.9rem, 3vw, 1.1rem);
    min-height: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    transition: all 0.15s ease;
    box-shadow: 0 4px 0 0 rgba(0, 0, 0, 1);
  }
  #rulesDialog button:hover {
    background: #FFA500;
    box-shadow: 0 2px 0 0 rgba(0, 0, 0, 1);
    transform: translateY(2px);
  }
  #rulesDialog button:active {
    background: #FFA500;
    transform: translateY(4px);
    box-shadow: none;
  }

  /* --- üÜï –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (HUD) --- */
  #info {
    position: fixed;
    bottom: clamp(0.5vh, 1vh, 1.5vh);
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));
    padding: clamp(0.4rem, 1.2vw, 0.6rem) clamp(0.7rem, 2.5vw, 1.2rem);
    border-radius: clamp(10px, 1.2rem, 16px);
    border: 4px solid #FFD700;
    font-weight: 900;
    font-size: clamp(0.8rem, 2.8vw, 1.1rem);
    color: #FFD700;
    box-shadow: 
      0 4px 0 0 rgba(0, 0, 0, 1),
      0 0 25px rgba(255, 215, 0, 0.5),
      inset 0 0 20px rgba(255, 215, 0, 0.15);
    user-select: none;
    z-index: 20;
    max-width: 95vw;
    text-align: center;
    line-height: 1.4;
    display: none;
    box-sizing: border-box;
    backdrop-filter: blur(10px);
    text-shadow: 
      0 0 8px rgba(255, 215, 0, 0.6),
      2px 2px 0 #000,
      -2px -2px 0 #000;
  }
  @media (max-width: 480px) {
    #info {
      font-size: clamp(0.7rem, 2.5vw, 0.9rem);
      padding: clamp(0.3rem, 1vw, 0.5rem) clamp(0.5rem, 2vw, 0.9rem);
      border-width: 3px;
    }
  }

  /* --- üÜï –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∂–∏–∑–Ω–∏ (HUD) --- */
  #lives {
    position: fixed;
    top: clamp(0.8vh, 1.5vh, 2vh);
    left: clamp(1vw, 2vw, 2.5vw);
    font-size: clamp(1.5rem, 5vw, 2.5rem);
    user-select: none;
    z-index: 30;
    color: #FFD700;
    text-shadow: 
      0 0 15px #FF6B6B,
      0 0 25px rgba(255, 107, 107, 0.6),
      2px 2px 0 #000,
      -2px -2px 0 #000;
    display: none;
    padding: clamp(0.4rem, 1.2vw, 0.7rem) clamp(0.6rem, 1.8vw, 1rem);
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.7));
    border-radius: clamp(10px, 1rem, 14px);
    border: 4px solid #FFD700;
    box-shadow: 
      0 4px 0 0 rgba(0, 0, 0, 1),
      0 0 25px rgba(255, 215, 0, 0.5),
      inset 0 0 20px rgba(255, 215, 0, 0.15);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  }
  /* –ü—É–ª—å—Å–∞—Ü–∏—è –ø—Ä–∏ —É—Ä–æ–Ω–µ */
  #lives.damaged {
    animation: livesDamage 0.6s ease-out;
  }
  @keyframes livesDamage {
    0%, 100% {
      border-color: #FFD700;
      box-shadow: 
        0 4px 0 0 rgba(0, 0, 0, 1),
        0 0 25px rgba(255, 215, 0, 0.5),
        inset 0 0 20px rgba(255, 215, 0, 0.15);
    }
    50% {
      border-color: #FF6B6B;
      box-shadow: 
        0 4px 0 0 rgba(0, 0, 0, 1),
        0 0 35px rgba(255, 107, 107, 0.9),
        inset 0 0 30px rgba(255, 107, 107, 0.3);
      transform: scale(1.1);
    }
  }

  /* --- –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞ —Å–Ω–∏–∑—É --- */
  #touchControls {
    position: fixed;
    bottom: clamp(0.5vh, 1vh, 1.5vh);
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    padding: 0 clamp(0.5rem, 2vw, 1rem);
    z-index: 30;
    user-select: none;
    pointer-events: auto;
    max-width: 100vw;
    box-sizing: border-box;
    display: none;
    gap: 0.5rem;
  }
  .touchBtn {
    background: #FBBF24;
    border: 3px solid #000;
    border-radius: clamp(10px, 1rem, 14px);
    width: clamp(50px, 14vw, 70px);
    height: clamp(50px, 14vw, 70px);
    min-width: 50px;
    min-height: 50px;
    font-size: clamp(1.5rem, 6vw, 2.5rem);
    color: #000;
    cursor: pointer;
    box-shadow: 0 4px 0 0 rgba(0, 0, 0, 1);
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.15s ease;
    touch-action: manipulation;
    font-weight: 900;
  }
  .touchBtn:active {
    background: #F59E0B;
    box-shadow: 0 1px 0 0 rgba(0, 0, 0, 1);
    transform: translateY(3px);
  }
  @media (min-width: 768px) {
    #touchControls {
      display: none !important;
    }
  }
  @media (max-width: 767px) {
    #touchControls {
      display: flex;
    }
  }

  /* --- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Å –∂–µ–ª—Ç–æ–π —Ä–∞–º–∫–æ–π --- */
  #welcomeScreen {
    position: fixed;
    inset: 0;
    background: black;
    color: #FFD700;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    user-select: none;
    z-index: 3000;
    padding: clamp(0.5rem, 2vw, 1rem);
    text-align: center;

    /* –ñ–µ–ª—Ç–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ä–∞–º–∫–∞ */
    box-sizing: border-box;
    border: 6px solid #000;
    border-radius: clamp(10px, 2vw, 20px);
    box-shadow: 0 0 0 4px #FFD700;
    
    /* –§–æ–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
    background-image: url('https://cdn.poehali.dev/files/6f16d2d4-f371-4b0f-a43e-c70a6de7b033.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  #welcomeScreen .welcome-box {
    background: rgba(0, 0, 0, 0.85);
    padding: clamp(1.5rem, 4vw, 3rem) clamp(1.5rem, 4vw, 3rem);
    border-radius: clamp(10px, 1rem, 16px);
    border: 4px solid #000;
    box-shadow: 0 6px 0 0 rgba(0, 0, 0, 1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: clamp(0.75rem, 2vw, 1rem);
    margin: auto;
    max-width: min(95vw, 600px);
  }
  #welcomeScreen h1 {
    font-size: clamp(2rem, 10vw, 4rem);
    font-weight: 900;
    text-shadow: 0 0 1rem #FFD700, 0 0 2rem #FFA500;
    animation: blinkYellow 1s linear infinite alternate;
    margin: 0;
    text-align: center;
    line-height: 1.2;
    word-break: break-word;
  }
  #welcomeScreen .subtitle {
    font-size: clamp(1.2rem, 5vw, 2rem);
    margin-top: clamp(0.25rem, 1vw, 0.5rem);
    font-weight: 700;
    text-shadow: 0 0 0.8rem #FFD700;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: clamp(0.25rem, 1vw, 0.5rem);
  }
  #welcomeScreen .subtitle strong {
    font-weight: 900;
  }
  #welcomeCharacter {
    font-size: clamp(2.5rem, 8vw, 3.5rem);
    user-select: none;
    position: relative;
    text-shadow: 1px 1px 0.2vw #2e1b0c;
    animation: sway 2s ease-in-out infinite;
    transform-origin: center bottom;
    transform-style: preserve-3d;
    transform-box: fill-box;
    transform: scaleX(-1);
  }
  #welcomeCharacter img {
    width: clamp(120px, 30vw, 200px) !important;
    height: clamp(120px, 30vw, 200px) !important;
  }
  #welcomeCharacter #dog {
    position: absolute;
    top: 0;
    left: 0.6em;
    font-size: 0.625em;
    opacity: 0.7;
    animation: rideDog 1s ease-in-out infinite;
    transform-origin: center center;
  }
  #welcomeCharacter #helmet {
    position: absolute;
    top: 0.1em;
    left: 0.6em;
    width: 0.2em;
    height: 0.15em;
    background: gold;
    border-radius: 1rem 1rem 0 0;
    box-shadow: inset 0 -0.3rem 0.2rem #cc9f00;
    animation: rideDog 1s ease-in-out infinite;
  }
  #welcomeCharacter #scooter {
    position: relative;
    z-index: 1;
    animation: rideScooter 1s ease-in-out infinite;
    transform-origin: center bottom;
  }
  @keyframes blinkYellow {
    0% { opacity: 1; }
    100% { opacity: 0.3; }
  }

  /* --- –≠–∫—Ä–∞–Ω –ü–û–¢–†–ê–ß–ï–ù–û --- */
  #gtaGameOverScreen {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    color: #ff0000;
    font-size: clamp(6rem, 20vw, 12rem);
    font-weight: 900;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    user-select: none;
    z-index: 4000;
    text-shadow:
      -2px -2px 0 #000,
      2px -2px 0 #000,
      -2px 2px 0 #000,
      2px 2px 0 #000;
    font-family: 'Impact', 'Arial Black', sans-serif;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    opacity: 0;
    animation: gtaFadeInOut 5s forwards;
    writing-mode: horizontal-tb;
    padding: 0 1rem;
    white-space: nowrap;
    overflow-wrap: normal;
    overflow-x: auto;
    display: none;
  }
  @media (max-width: 480px), (max-height: 700px) {
    #gtaGameOverScreen {
      font-size: clamp(3rem, 15vw, 6rem);
      letter-spacing: 0.05em;
      padding: 0 0.5rem;
      white-space: normal;
      overflow-x: visible;
      word-break: break-word;
    }
  }
  @keyframes gtaFadeInOut {
    0% {
      opacity: 0;
      transform: scale(0.7);
    }
    20% {
      opacity: 1;
      transform: scale(1);
    }
    80% {
      opacity: 1;
      transform: scale(1);
    }
    100% {
      opacity: 0;
      transform: scale(0.7);
    }
  }

  /* --- –ü–æ–¥–Ω–∏–º–∞–µ–º –∫–µ–ø–æ—á–∫—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö --- */
  @media (max-width: 767px) {
    #helmet {
      top: 0.0em !important;
      height: 0.18em !important;
      width: 0.22em !important;
      box-shadow: inset 0 -0.35rem 0.25rem #cc9f00 !important;
    }
  }
  
  /* --- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ --- */
  @media (max-width: 360px) {
    #mainMenu .menu-content {
      padding: clamp(0.75rem, 2.5vw, 1rem);
      gap: clamp(0.75rem, 2vw, 1rem);
    }
    #mainMenu button {
      font-size: clamp(0.85rem, 3.2vw, 1rem);
      padding: clamp(0.5rem, 1.8vw, 0.7rem) clamp(0.8rem, 3.5vw, 1.5rem);
    }
    #mainMenu .menu-footer {
      padding: clamp(0.6rem, 1.8vw, 0.8rem) clamp(0.8rem, 2.5vw, 1rem);
    }
    #mainMenu .menu-footer-icons {
      font-size: clamp(0.65rem, 2vw, 0.75rem);
      gap: clamp(0.4rem, 1.5vw, 0.6rem);
    }
    #touchControls {
      padding: 0 clamp(0.3rem, 1.5vw, 0.5rem);
    }
  }
  
  /* --- –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö --- */
  @media (max-height: 500px) and (orientation: landscape) {
    #mainMenu .menu-content {
      padding: clamp(0.5rem, 1.5vw, 1rem);
      gap: clamp(0.5rem, 1.5vw, 0.75rem);
      max-height: 90vh;
      overflow-y: auto;
    }
    #menuLogo {
      padding: clamp(0.5rem, 1.5vw, 1rem) clamp(0.75rem, 2vw, 1.5rem);
    }
    #menuLogo .nd {
      font-size: clamp(1.2rem, 4vw, 1.8rem);
    }
    #mainMenu button {
      padding: clamp(0.4rem, 1.5vw, 0.6rem) clamp(0.8rem, 3vw, 1.5rem);
      min-height: 40px;
    }
    #menuCharacter img {
      width: clamp(80px, 20vw, 120px) !important;
      height: clamp(80px, 20vw, 120px) !important;
    }
    #welcomeCharacter img {
      width: clamp(80px, 20vw, 120px) !important;
      height: clamp(80px, 20vw, 120px) !important;
    }
    #welcomeScreen h1 {
      font-size: clamp(1.5rem, 8vw, 2.5rem);
    }
  }
  

</style>
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
<div id="welcomeScreen" role="alert" aria-live="assertive" aria-label="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã">
  <div class="welcome-box">
    <h1>–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞</h1>
    <div class="subtitle">
      <div id="welcomeCharacter" aria-label="–ü–µ—Ä—Å–æ–Ω–∞–∂ –∫—É—Ä—å–µ—Ä–∞ –∫–æ—Ä–≥–∏" role="img" style="display:inline-block;">
        <img src="https://cdn.poehali.dev/files/d91aa39a-b906-481f-95ef-6c750cb6a76a.png" alt="–ö—É—Ä—å–µ—Ä –∫–æ—Ä–≥–∏" style="width:200px; height:200px; object-fit:contain; animation: bounce 2s infinite ease-in-out;" />
      </div>
    </div>
  </div>
</div>

<!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
<div id="mainMenu" role="menu" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–≥—Ä—ã" tabindex="0" style="display:none;">
  <!-- –ï–¥–∏–Ω–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –≤—Å–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –º–µ–Ω—é -->
  <div class="menu-content">
    <!-- –õ–æ–≥–æ—Ç–∏–ø -->
    <div id="menuLogo" aria-label="–õ–æ–≥–æ—Ç–∏–ø –∏–≥—Ä—ã">
      <div class="nd">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞</div>
      <div class="text">
        <div id="menuCharacter" aria-label="–ü–µ—Ä—Å–æ–Ω–∞–∂ –∫—É—Ä—å–µ—Ä–∞ –∫–æ—Ä–≥–∏" role="img" style="display:inline-block;">
          <img src="https://cdn.poehali.dev/files/d91aa39a-b906-481f-95ef-6c750cb6a76a.png" alt="–ö—É—Ä—å–µ—Ä –∫–æ—Ä–≥–∏" style="width:200px; height:200px; object-fit:contain; animation: bounce 2s infinite ease-in-out;" />
        </div>
      </div>
    </div>
    
    <!-- –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ -->
    <div id="gameMarquee" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –±–æ–Ω—É—Å—ã">
      <div class="marquee-content" style="animation-duration: 15s;">
        <span class="marquee-item"><span class="emoji-icon">üöÄ</span> –°—Ç–∞—Ä—Ç –±–µ–∑ –æ–ø—ã—Ç–∞ ‚Äî –∑–∞—Ä–∞–±–æ—Ç–∞–π —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è!</span>
        <span class="marquee-item"><span class="emoji-icon">üíµ</span> –ë–æ–Ω—É—Å 3000‚ÇΩ –∑–∞ –ø–µ—Ä–≤—ã–µ 30 –∑–∞–∫–∞–∑–æ–≤ ‚Äî –∂–º–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏ –∑–∞—è–≤–∫—É!</span>
        <span class="marquee-item"><span class="emoji-icon">üöÄ</span> –°—Ç–∞—Ä—Ç –±–µ–∑ –æ–ø—ã—Ç–∞ ‚Äî –∑–∞—Ä–∞–±–æ—Ç–∞–π —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è!</span>
        <span class="marquee-item"><span class="emoji-icon">üíµ</span> –ë–æ–Ω—É—Å 3000‚ÇΩ –∑–∞ –ø–µ—Ä–≤—ã–µ 30 –∑–∞–∫–∞–∑–æ–≤ ‚Äî –∂–º–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏ –∑–∞—è–≤–∫—É!</span>
        <span class="marquee-item"><span class="emoji-icon">üöÄ</span> –°—Ç–∞—Ä—Ç –±–µ–∑ –æ–ø—ã—Ç–∞ ‚Äî –∑–∞—Ä–∞–±–æ—Ç–∞–π —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è!</span>
        <span class="marquee-item"><span class="emoji-icon">üíµ</span> –ë–æ–Ω—É—Å 3000‚ÇΩ –∑–∞ –ø–µ—Ä–≤—ã–µ 30 –∑–∞–∫–∞–∑–æ–≤ ‚Äî –∂–º–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏ –∑–∞—è–≤–∫—É!</span>
        <span class="marquee-item"><span class="emoji-icon">üöÄ</span> –°—Ç–∞—Ä—Ç –±–µ–∑ –æ–ø—ã—Ç–∞ ‚Äî –∑–∞—Ä–∞–±–æ—Ç–∞–π —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è!</span>
        <span class="marquee-item"><span class="emoji-icon">üíµ</span> –ë–æ–Ω—É—Å 3000‚ÇΩ –∑–∞ –ø–µ—Ä–≤—ã–µ 30 –∑–∞–∫–∞–∑–æ–≤ ‚Äî –∂–º–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏ –∑–∞—è–≤–∫—É!</span>
      </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
    <div class="menu-buttons">
      <button id="playBtn" role="menuitem">üéÆ –ò–≥—Ä–∞—Ç—å</button>
      <button id="leaderboardBtn" role="menuitem">üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</button>
      <button id="rulesBtn" role="menuitem">üìñ –ü—Ä–∞–≤–∏–ª–∞</button>
      <button id="toggleMusicBtn" role="menuitem">üîä –ú—É–∑—ã–∫–∞: –í–ö–õ</button>
      <button id="becomeBtn" role="menuitem">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    </div>

    <!-- –§—É—Ç–µ—Ä –º–µ–Ω—é -->
    <div class="menu-footer">
      <div class="menu-footer-icons">
        <div class="menu-footer-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
          <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</span>
        </div>
        <div class="menu-footer-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
          <span>–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ</span>
        </div>
        <div class="menu-footer-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
          <span>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</span>
        </div>
      </div>
      <div class="menu-footer-copyright">
        <p>¬© 2025 | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã!</p>
      </div>
    </div>
  </div>
</div>

<!-- –ü—Ä–∞–≤–∏–ª–∞ -->
<div id="rulesDialog" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
  <h2 id="rulesTitle">–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
  <ul>
    <li>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫—É—Ä—å–µ—Ä–æ–º (üõµ) —Å—Ç—Ä–µ–ª–∫–∞–º–∏ ‚Üë –∏ ‚Üì –∏–ª–∏ –∫–∞—Å–∞–Ω–∏—è–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.</li>
    <li>–ö—É—Ä—å–µ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –ø–æ –ø—è—Ç–∏ –ø–æ–ª–æ—Å–∞–º –¥–≤–∏–∂–µ–Ω–∏—è, –º–µ–Ω—è—è –ø–æ–∑–∏—Ü–∏—é –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑.</li>
    <li>–°–æ–±–∏—Ä–∞–π—Ç–µ –µ–¥—É (üçï, üçî, üçü, üå≠, üçó, üåÆ) –¥–ª—è –æ—á–∫–æ–≤.</li>
    <li>–†–∞–∑–Ω—ã–µ –≤–∏–¥—ã —Ñ–∞—Å—Ç-—Ñ—É–¥–∞ –¥–∞—é—Ç —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤.</li>
    <li>–ü–æ—è–≤–ª—è—é—Ç—Å—è –∞–ø—Ç–µ—á–∫–∏ (ü©π), –∫–æ—Ç–æ—Ä—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –∂–∏–∑–Ω—å.</li>
    <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –ø–µ—à–µ—Ö–æ–¥–æ–≤ –∏ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏—Ö ‚Äî —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –æ—Ç–Ω–∏–º–∞—é—Ç –∂–∏–∑–Ω–∏:
      <ul>
        <li>–°—Ç–æ—è—á–∏–π –ø–µ—à–µ—Ö–æ–¥ (üßç) –æ—Ç–Ω–∏–º–∞–µ—Ç 0.5 ‚ù§Ô∏è.</li>
        <li>–ò–¥—É—â–∏–µ –ø–µ—à–µ—Ö–æ–¥—ã (üö∂‚Äç‚ôÇÔ∏è, üö∂‚Äç‚ôÄÔ∏è) –æ—Ç–Ω–∏–º–∞—é—Ç 1 ‚ù§Ô∏è.</li>
        <li>–°—Ç–æ—è—á–∏–π –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–π (üëÆ‚Äç‚ôÇÔ∏è) –æ—Ç–Ω–∏–º–∞–µ—Ç 1.5 ‚ù§Ô∏è.</li>
        <li>–ü–æ–ª–∏—Ü–µ–π—Å–∫–∞—è –º–∞—à–∏–Ω–∞ —Å –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–º (üöìüëÆ‚Äç‚ôÇÔ∏è) –æ—Ç–Ω–∏–º–∞–µ—Ç 2 ‚ù§Ô∏è.</li>
      </ul>
    </li>
    <li>–ü–æ—è–≤–ª—è—é—Ç—Å—è –±–æ–Ω—É—Å—ã: —É—Å–∫–æ—Ä–µ–Ω–∏–µ (‚ö°Ô∏è) –∏ –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å (üõ°Ô∏è).</li>
    <li>–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –∏–ª–∏ —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ –ø–æ–ª–æ—Å–∞–º.</li>
    <li>–ò–≥—Ä–∞ —É—Å–ª–æ–∂–Ω—è–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.</li>
    <li>–°–æ–±–∏—Ä–∞–π—Ç–µ –∫–æ–º–±–æ –µ–¥—ã –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—á–∫–æ–≤.</li>
    <li>–ò–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∂–∏–∑–Ω–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è.</li>
  </ul>
  <button id="closeRulesBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="container" role="main" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ —Å –¥–æ—Ä–æ–∂–∫–æ–π –∏ –ª–µ—Å–æ–º" style="display:none;">

  <div class="city-strip" aria-hidden="true">
    <div class="scrolling-objects" aria-hidden="true" id="topObjects" tabindex="-1" aria-hidden="true">
      üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥
      üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥
    </div>
  </div>

  <div id="game" aria-label="–î–æ—Ä–æ–∂–∫–∞ —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º" style="position:relative;">
    <div class="lane lane0"></div>
    <div class="lane lane1"></div>
    <div class="lane lane2"></div>
    <div class="lane lane3"></div>
    <div class="lane lane4"></div>

    <div id="courier" aria-label="–ö—É—Ä—å–µ—Ä –∫–æ—Ä–≥–∏ –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ" role="img" aria-live="polite">
      <img src="https://cdn.poehali.dev/files/d91aa39a-b906-481f-95ef-6c750cb6a76a.png" alt="–ö—É—Ä—å–µ—Ä –∫–æ—Ä–≥–∏" style="width:100px; height:100px; object-fit:contain; animation: bounce 1s infinite ease-in-out; transform: scaleX(-1);" />
    </div>
    <div id="speechBubble" aria-live="polite" role="alert"></div>
  </div>

  <div class="city-strip" aria-hidden="true">
    <div class="scrolling-objects" aria-hidden="true" id="bottomObjects" tabindex="-1" aria-hidden="true">
      üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤
      üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤üå≥üå≤
    </div>
  </div>



</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div id="info" aria-live="polite" style="display:none;">
  –û—á–∫–∏: <span id="score">0</span> | –ñ–∏–∑–Ω–∏: <span id="lifeCount">3</span> | –í—Ä–µ–º—è: <span id="timer">0</span> —Å–µ–∫<br>
  –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∞–º–∏ ‚Üë –∏ ‚Üì, —á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –ø–æ –ø–æ–ª–æ—Å–∞–º.
</div>

<!-- –ñ–∏–∑–Ω–∏ -->
<div id="lives" aria-label="–ñ–∏–∑–Ω–∏ –∏–≥—Ä–æ–∫–∞" role="img" aria-live="polite" style="display:none;">
  ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è
</div>

<!-- –ú–µ–Ω—é –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
<div id="gameOverMenu" role="dialog" aria-modal="true" aria-labelledby="gameOverTitle" style="display:none;">
  <div id="gameOverTitle" style="margin-bottom: 12px;">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div>
  <div id="gameOverStats" style="margin-bottom: 16px;">
    <div style="font-size: 1.8rem; font-weight: bold; color: #FFD700; margin-bottom: 8px;">–í–∞—à —Å—á—ë—Ç: <span id="finalScore">0</span></div>
    <div id="gameOverMessage" style="font-size: 1rem; color: #ccc; margin-bottom: 12px;"></div>
  </div>
  <button id="restartBtn">üîÑ –ó–∞–Ω–æ–≤–æ</button>
  <button id="toMenuBtn">üìã –í –º–µ–Ω—é</button>
  <button id="saveScoreBtn" style="display:none;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
  <button id="loginToSaveBtn" style="display:none;">üîê –í–æ–π—Ç–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –ü–û–¢–†–ê–ß–ï–ù–û -->
<div id="gtaGameOverScreen" role="alert" aria-live="assertive" aria-label="–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ - –ü–æ—Ç—Ä–∞—á–µ–Ω–æ" style="display:none;">
  –ü–û–¢–†–ê–ß–ï–ù–û
</div>

<!-- –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
<div id="touchControls" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞" role="group" style="display:none;">
  <button id="btnUp" aria-label="–í–≤–µ—Ä—Ö" class="touchBtn">‚ñ≤</button>
  <button id="btnDown" aria-label="–í–Ω–∏–∑" class="touchBtn">‚ñº</button>
</div>

<script>
(() => {
  // –≠–ª–µ–º–µ–Ω—Ç—ã
  const welcomeScreen = document.getElementById('welcomeScreen');
  const mainMenu = document.getElementById('mainMenu');
  const rulesDialog = document.getElementById('rulesDialog');
  const gameOverMenu = document.getElementById('gameOverMenu');
  const container = document.getElementById('container');
  const info = document.getElementById('info');
  const courier = document.getElementById('courier');
  const scoreElem = document.getElementById('score');
  const finalScoreElem = document.getElementById('finalScore');
  const livesElem = document.getElementById('lives');
  const lifeCountElem = document.getElementById('lifeCount');
  const btnUp = document.getElementById('btnUp');
  const btnDown = document.getElementById('btnDown');
  const gtaGameOverScreen = document.getElementById('gtaGameOverScreen');
  const touchControls = document.getElementById('touchControls');
  const playBtn = document.getElementById('playBtn');
  const leaderboardBtn = document.getElementById('leaderboardBtn');
  const rulesBtn = document.getElementById('rulesBtn');
  const closeRulesBtn = document.getElementById('closeRulesBtn');
  const restartBtn = document.getElementById('restartBtn');
  const toMenuBtn = document.getElementById('toMenuBtn');
  const saveScoreBtn = document.getElementById('saveScoreBtn');
  const loginToSaveBtn = document.getElementById('loginToSaveBtn');
  const becomeBtn = document.getElementById('becomeBtn');
  const toggleMusicBtn = document.getElementById('toggleMusicBtn');
  const game = document.getElementById('game');
  const speechBubble = document.getElementById('speechBubble');
  const lanes = document.querySelectorAll('.lane');

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  const isMobile = window.innerWidth <= 767;
  const isLowEndDevice = isMobile && (navigator.hardwareConcurrency <= 4 || navigator.deviceMemory <= 4);

  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
  let score = 0;
  let lives = 3;
  let gameOverFlag = false;
  let paused = false;
  let gameTime = 0;
  let comboCount = 0;
  let comboTimeout = null;
  const maxSpeedX = isLowEndDevice ? 5 : (isMobile ? 7 : 12);
  let speedX = isLowEndDevice ? 2 : (isMobile ? 3 : 4);

  let lanePositions = [];
  let courierLane = 2;
  let courierCurrentY = 0;
  let courierTargetLane = 2;

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º
  let movingUp = false;
  let movingDown = false;

  let pedestrians = [];
  let standingPeds = [];
  let policeStandings = [];
  let foods = [];
  let medkits = [];
  let bonuses = [];
  let policeCars = [];

  let pedestrianSpawnTimer;
  let standingPedSpawnTimer;
  let policeStandingSpawnTimer;
  let foodSpawnTimer;
  let medkitSpawnTimer;
  let bonusSpawnTimer;
  let policeCarSpawnTimer;
  let trafficLightSpawnTimer; // üÜï –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã
  let gameLoopId;
  let lastFrameTime = 0;
  let timerInterval;

  let shieldActive = false;
  let speedBoostActive = false;
  let speedBoostTimeout = null;
  let shieldTimeout = null;

  const pedestrianPhrases = [
    "–û–ø–∞, –∂–∏–≤—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–µ!",
    "–ü–µ—à–µ—Ö–æ–¥—ã! –í—Ä—É–±–∞–π —Ä–µ–∂–∏–º –Ω–∏–Ω–¥–∑—è!",
    "–õ—é–¥–∏ –∏–¥—É—Ç ‚Äî –≥–∞–∑ –≤ –ø–æ–ª, –±—Ä–∞—Ç!",
    "–°–º–æ—Ç—Ä–∏, —Ç—É—Ç —Ç–æ–ª–ø–∞! –í–∂—É—Ö ‚Äî –∏ –º—ã —É–∂–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ!",
    "–ü–µ—à–µ—Ö–æ–¥—ã ‚Äî –≥–ª–∞–≤–Ω—ã–µ —Ç–æ—Ä–º–æ–∑–∞ –∂–∏–∑–Ω–∏!",
    "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ, —Ö–æ–¥—è—á–∏–µ –∫–µ–≥–ª–∏!",
    "–ü–µ—à–µ—Ö–æ–¥—ã! –í—Ä–µ–º—è –¥–ª—è —Ç–∞–Ω—Ü–µ–≤ –Ω–∞ —Å–∫—É—Ç–µ—Ä–µ!",
    "–õ—é–¥–∏ –∏–¥—É—Ç, –∫–∞–∫ –±—É–¥—Ç–æ —è –∏–º –¥–æ–ª–∂–µ–Ω!",
    "–ü–µ—à–µ—Ö–æ–¥—ã ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–≤–µ—Å—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å!",
    "–•–∞! –ü–µ—à–µ—Ö–æ–¥—ã, –≤—ã –º–µ–Ω—è –Ω–µ –¥–æ–≥–æ–Ω–∏—Ç–µ!",
    "–ü–µ—à–µ—Ö–æ–¥—ã ‚Äî –≥–ª–∞–≤–Ω–∞—è —É–≥—Ä–æ–∑–∞ –º–æ–µ–º—É —Å—Ç–∏–ª—é!",
    "–ñ–∏–≤—ã–µ –ø—Ä–æ–±–∫–∏ –Ω–∞ –∫–æ–ª–µ—Å–∞—Ö!",
    "–ü–µ—à–µ—Ö–æ–¥—ã –∏–¥—É—Ç ‚Äî –∑–Ω–∞—á–∏—Ç, –≤—Ä–µ–º—è –¥–ª—è —Ç—Ä—é–∫–æ–≤!",
    "–ü–µ—à–µ—Ö–æ–¥—ã ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∂–∏–≤—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –æ–±—ä–µ—Ö–∞—Ç—å!",
    "–ü–µ—à–µ—Ö–æ–¥—ã! –í—Ä–µ–º—è –¥–ª—è –ø–∞—Ä–∫—É—Ä–∞ –Ω–∞ —Å–∫—É—Ç–µ—Ä–µ!"
  ];
  const policePhrases = [
    "–û–ø–∞, –º—É—Å–æ—Ä–∞ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ! –í–∂—É—Ö ‚Äî –∏ –Ω–µ—Ç –º–µ–Ω—è!",
    "–ö–æ–ø—ã –µ–¥—É—Ç, –ø–æ—Ä–∞ –¥–µ–ª–∞—Ç—å –Ω–æ–≥–∏, –∫–∞–∫ –≤ —Ñ–∏–ª—å–º–∞—Ö!",
    "–ú—É—Å–æ—Ä–∞! –í—Ä—É–±–∞–π —Ç—É—Ä–±–æ, –Ω–µ —Ç–æ—Ä–º–æ–∑–∏!",
    "–ü–æ–ª–∏—Ü–∏—è –Ω–∞ —Ö–≤–æ—Å—Ç–µ, –Ω–∞–¥–æ —É–ª–∏–∑–Ω—É—Ç—å –∫–∞–∫ –Ω–∏–Ω–¥–∑—è!",
    "–í–æ—Ç –∏ –º—É—Å–æ—Ä–∞, –≤—Ä–µ–º—è –¥–ª—è —Å—É–ø–µ—Ä-–º–∞–Ω—ë–≤—Ä–∞!",
    "–ö–æ–ø—ã –∏–¥—É—Ç ‚Äî –ø—Ä–∏—Ç–≤–æ—Ä—é—Å—å –Ω–µ–≤–∏–¥–∏–º–∫–æ–π!",
    "–ú—É—Å–æ—Ä–∞ –±–ª–∏–∑–∫–æ, –ø–æ—Ä–∞ –≤–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º ¬´–ø—Ä–∏–∑—Ä–∞–∫¬ª!",
    "–ü–æ–ª–∏—Ü–∏—è –≤ –∑–æ–Ω–µ, –¥–∞–≤–∞–π-–∫–∞ –ø–æ-–±—ã—Å—Ç—Ä–µ–µ!",
    "–ö–æ–ø—ã –Ω–∞ —Ö–≤–æ—Å—Ç–µ ‚Äî –≤–∫–ª—é—á–∞—é —Ä–µ–∂–∏–º ¬´–°—Ç—å—é¬ª!",
    "–ú—É—Å–æ—Ä–∞ –Ω–∞ –¥–æ—Ä–æ–≥–µ? –ü–æ—à–ª–∏, —è –∏—Ö –æ–±–≥–æ–Ω—é!",
    "–ü–æ–ª–∏—Ü–∏—è –≤ —Ä–∞–¥–∏—É—Å–µ ‚Äî –≤–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º ¬´Stuey.Go¬ª!",
    "–ú—É—Å–æ—Ä–∞ –∏–¥—É—Ç, –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –≤–∏–¥, —á—Ç–æ —è –ø—Ä–æ—Å—Ç–æ –ø–∏—Ü—Ü–∞!",
    "–ö–æ–ø—ã –Ω–∞ —Ö–≤–æ—Å—Ç–µ, –Ω–∞–¥–æ —Å—Ä–æ—á–Ω–æ –Ω–∞ –ø–µ—Ä–µ–∫—É—Å!",
    "–ü–æ–ª–∏—Ü–∏—è ‚Äî –Ω–µ –ø–æ–≤–æ–¥ –¥–ª—è –ø–∞–Ω–∏–∫–∏, –∞ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏!",
    "–ú—É—Å–æ—Ä–∞ –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –≤–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º ¬´–Ω–µ–≤–∏–¥–∏–º–∫–∞¬ª!"
  ];

  let lastSpeechTime = 0;
  const speechCooldown = 4000; // 4 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —Ä–µ—á–∞–º–∏

  // –ó–∞–¥–µ—Ä–∂–∫–∞ —Å–º–µ–Ω—ã –ø–æ–ª–æ—Å—ã –ø—Ä–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–∏
  let moveCooldown = 0;

  // –î–ª—è –ø–æ–∫–∞–∑–∞ —Ä–µ—á–∏
  let speechTimeout = null;

  // --- –§—É–Ω–∫—Ü–∏–∏ ---

  function recalcLanes() {
    lanePositions = [];
    const laneCount = 5;
    const gameRect = game.getBoundingClientRect();
    for(let i=0; i<laneCount; i++) {
      lanePositions.push(gameRect.top + gameRect.height * ((i + 0.5) / laneCount));
    }
    courierCurrentY = lanePositions[courierLane] - courier.offsetHeight / 2;
    courier.style.top = courierCurrentY + 'px';

    [...pedestrians, ...standingPeds, ...policeStandings, ...foods, ...medkits, ...bonuses, ...policeCars].forEach(obj => {
      const lane = obj.lane;
      if (lanePositions[lane]) {
        obj.elem.style.top = (lanePositions[lane] - obj.elem.offsetHeight / 2) + 'px';
      }
    });
  }

  function updateCourierPositionSmooth() {
    const targetY = lanePositions[courierTargetLane] - courier.offsetHeight / 2;
    let diff = targetY - courierCurrentY;
    if (Math.abs(diff) < 1) {
      courierCurrentY = targetY;
      courierLane = courierTargetLane;
    } else {
      courierCurrentY += diff * 0.25;
    }
    courier.style.top = courierCurrentY + 'px';
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
  function createPedestrian() {
    if (gameOverFlag) return;
    const ped = document.createElement('div');
    ped.classList.add('pedestrian');
    const lane = Math.floor(Math.random() * 5);
    ped.dataset.lane = lane;
    ped.style.top = (lanePositions[lane] - 24) + 'px';
    ped.style.left = window.innerWidth + 'px';
    const pedestrianEmojis = ['üö∂‚Äç‚ôÇÔ∏è', 'üö∂‚Äç‚ôÄÔ∏è'];
    ped.textContent = pedestrianEmojis[Math.floor(Math.random() * pedestrianEmojis.length)];
    game.appendChild(ped);
    const speedFactor = 0.8 + Math.random() * 0.4;
    pedestrians.push({ elem: ped, x: window.innerWidth, lane, speed: speedX * speedFactor });
  }
  function createStandingPedestrian() {
    if (gameOverFlag) return;
    const ped = document.createElement('div');
    ped.classList.add('pedestrian');
    const lane = Math.floor(Math.random() * 5);
    ped.dataset.lane = lane;
    ped.style.top = (lanePositions[lane] - 24) + 'px';
    ped.style.left = window.innerWidth + 'px';
    ped.textContent = 'üßç';
    game.appendChild(ped);
    standingPeds.push({ elem: ped, x: window.innerWidth, lane, speed: speedX * 0.5 });
  }
  function createPoliceStanding() {
    if (gameOverFlag) return;
    const cop = document.createElement('div');
    cop.classList.add('policeStanding');
    const lane = Math.floor(Math.random() * 5);
    cop.dataset.lane = lane;
    cop.style.top = (lanePositions[lane] - 24) + 'px';
    cop.style.left = window.innerWidth + 'px';
    cop.textContent = 'üëÆ‚Äç‚ôÇÔ∏è';
    game.appendChild(cop);
    policeStandings.push({ elem: cop, x: window.innerWidth, lane, speed: speedX * 0.5 });
  }
  function createFood() {
    if (gameOverFlag) return;
    const food = document.createElement('div');
    food.classList.add('food');
    const lane = Math.floor(Math.random() * 5);
    food.dataset.lane = lane;
    food.style.top = (lanePositions[lane] - 24) + 'px';
    food.style.left = window.innerWidth + 'px';
    const foodItems = [
      { emoji: 'üçï', points: 10 },
      { emoji: 'üçî', points: 8 },
      { emoji: 'üçü', points: 7 },
      { emoji: 'üå≠', points: 6 },
      { emoji: 'üçó', points: 9 },
      { emoji: 'üåÆ', points: 11 }
    ];
    const item = foodItems[Math.floor(Math.random() * foodItems.length)];
    food.textContent = item.emoji;
    game.appendChild(food);
    foods.push({ elem: food, x: window.innerWidth, lane, points: item.points, speed: speedX });
  }
  function createMedkit() {
    if (gameOverFlag) return;
    const medkit = document.createElement('div');
    medkit.classList.add('medkit');
    const lane = Math.floor(Math.random() * 5);
    medkit.dataset.lane = lane;
    medkit.style.top = (lanePositions[lane] - 24) + 'px';
    medkit.style.left = window.innerWidth + 'px';
    medkit.textContent = 'ü©π';
    game.appendChild(medkit);
    medkits.push({ elem: medkit, x: window.innerWidth, lane, speed: speedX });
  }
  function createBonus() {
    if (gameOverFlag) return;
    const bonus = document.createElement('div');
    bonus.classList.add('bonus');
    const lane = Math.floor(Math.random() * 5);
    bonus.dataset.lane = lane;
    bonus.style.top = (lanePositions[lane] - 24) + 'px';
    bonus.style.left = window.innerWidth + 'px';
    const bonusesArr = ['‚ö°Ô∏è', 'üõ°Ô∏è'];
    bonus.textContent = bonusesArr[Math.floor(Math.random() * bonusesArr.length)];
    game.appendChild(bonus);
    bonuses.push({ elem: bonus, x: window.innerWidth, lane, speed: speedX, type: bonus.textContent });
  }
  function createPoliceCar() {
    if (gameOverFlag) return;
    const car = document.createElement('div');
    car.classList.add('policeCar');
    const lane = Math.floor(Math.random() * 5);
    car.dataset.lane = lane;
    car.style.top = (lanePositions[lane] - 24) + 'px';
    car.style.left = window.innerWidth + 'px';
    car.textContent = 'üöìüëÆ‚Äç‚ôÇÔ∏è';
    game.appendChild(car);
    policeCars.push({ elem: car, x: window.innerWidth, lane, speed: speedX * 1.5 });
  }

  function updateObjects(delta) {
    // –í—Å–µ –æ–±—ä–µ–∫—Ç—ã –¥–≤–∏–∂—É—Ç—Å—è –≤–ª–µ–≤–æ —Å —É—á–µ—Ç–æ–º delta –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
    function moveArray(arr) {
      for(let i=arr.length-1; i>=0; i--) {
        let obj = arr[i];
        obj.x -= obj.speed * delta;
        if (obj.x < -50) {
          obj.elem.remove();
          arr.splice(i,1);
        } else {
          obj.elem.style.left = obj.x + 'px';
        }
      }
    }
    moveArray(pedestrians);
    moveArray(standingPeds);
    moveArray(policeStandings);
    moveArray(foods);
    moveArray(medkits);
    moveArray(bonuses);
    moveArray(policeCars);
    moveArray(trafficLights); // üÜï –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã –¥–≤–∏–≥–∞—é—Ç—Å—è
  }

  function checkCollisions() {
    if (gameOverFlag) return;

    const courierRect = courier.getBoundingClientRect();

    function isCollide(r1, r2) {
      return !(r2.left > r1.right || 
               r2.right < r1.left || 
               r2.top > r1.bottom ||
               r2.bottom < r1.top);
    }

    for(let i=pedestrians.length-1; i>=0; i--) {
      let p = pedestrians[i];
      if (p.lane === courierLane) {
        const r = p.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          if (!shieldActive) {
            loseLife(1);
            showSpeechRandom(pedestrianPhrases);
          }
          p.elem.remove();
          pedestrians.splice(i, 1);
          return;
        }
      }
    }
    for(let i=standingPeds.length-1; i>=0; i--) {
      let p = standingPeds[i];
      if (p.lane === courierLane) {
        const r = p.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          if (!shieldActive) {
            loseLife(0.5);
            showSpeechRandom(pedestrianPhrases);
          }
          p.elem.remove();
          standingPeds.splice(i, 1);
          return;
        }
      }
    }
    for(let i=policeStandings.length-1; i>=0; i--) {
      let p = policeStandings[i];
      if (p.lane === courierLane) {
        const r = p.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          if (!shieldActive) {
            loseLife(1.5);
            showSpeechRandom(policePhrases);
          }
          p.elem.remove();
          policeStandings.splice(i, 1);
          return;
        }
      }
    }
    for(let i=policeCars.length-1; i>=0; i--) {
      let p = policeCars[i];
      if (p.lane === courierLane) {
        const r = p.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          if (!shieldActive) {
            loseLife(2);
            showSpeechRandom(policePhrases);
          }
          p.elem.remove();
          policeCars.splice(i, 1);
          return;
        }
      }
    }
    for(let i=foods.length-1; i>=0; i--) {
      let f = foods[i];
      if (f.lane === courierLane) {
        const r = f.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          const points = f.points + (comboCount > 1 ? comboCount * 2 : 0);
          score += f.points;
          comboCount++;
          if (comboTimeout) clearTimeout(comboTimeout);
          comboTimeout = setTimeout(() => {
            comboCount = 0;
          }, 3000);
          if (comboCount > 1) {
            score += comboCount * 2;
          }
          updateScoreDisplay();
          
          // üÜï –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ —Å–±–æ—Ä–µ –µ–¥—ã
          createConfetti(r.left + r.width / 2, r.top + r.height / 2);
          showFloatingScore(points, r.left + r.width / 2, r.top);
          
          f.elem.remove();
          foods.splice(i, 1);
          return;
        }
      }
    }
    for(let i=medkits.length-1; i>=0; i--) {
      let m = medkits[i];
      if (m.lane === courierLane) {
        const r = m.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          if (lives < 3) {
            lives = Math.min(3, lives + 1);
            updateLivesDisplay();
          }
          m.elem.remove();
          medkits.splice(i, 1);
          return;
        }
      }
    }
    for(let i=bonuses.length-1; i>=0; i--) {
      let b = bonuses[i];
      if (b.lane === courierLane) {
        const r = b.elem.getBoundingClientRect();
        if (isCollide(courierRect, r)) {
          if (b.type === '‚ö°Ô∏è') {
            activateSpeedBoost();
          } else if (b.type === 'üõ°Ô∏è') {
            activateShield();
          }
          b.elem.remove();
          bonuses.splice(i, 1);
          return;
        }
      }
    }
  }

  function loseLife(amount) {
    if (shieldActive) return;
    lives -= amount;
    if (lives < 0) lives = 0;
    updateLivesDisplay();
    
    // üÜï –≠—Ñ—Ñ–µ–∫—Ç —Ç—Ä—è—Å–∫–∏ –ø—Ä–∏ —É—Ä–æ–Ω–µ
    game.classList.add('shake');
    setTimeout(() => game.classList.remove('shake'), 500);
    
    // üÜï –ü—É–ª—å—Å–∞—Ü–∏—è –∂–∏–∑–Ω–µ–π
    const livesElem = document.getElementById('lives');
    if (livesElem) {
      livesElem.classList.add('damaged');
      setTimeout(() => livesElem.classList.remove('damaged'), 600);
    }
    
    if (lives <= 0) {
      gameOver();
    }
  }
  
  // üÜï –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –ø—ã–ª–∏ –∏–∑-–ø–æ–¥ –∫–æ–ª–µ—Å - —Å–Ω–∏–∑—É —Å–ª–µ–≤–∞ –æ—Ç –≥–µ—Ä–æ—è
  let lastDustTime = 0;
  function createDustParticles() {
    const now = Date.now();
    if (now - lastDustTime < 100) return;
    lastDustTime = now;
    
    const courierRect = courier.getBoundingClientRect();
    const gameRect = game.getBoundingClientRect();
    
    for (let i = 0; i < 2; i++) {
      const dust = document.createElement('div');
      dust.className = 'dust-particle';
      // –ï—â–µ –ª–µ–≤–µ–µ –∏ —á—É—Ç—å –Ω–∏–∂–µ
      dust.style.left = `${courierRect.left - gameRect.left - 10 + (Math.random() * 5)}px`;
      dust.style.top = `${courierRect.bottom - gameRect.top + (Math.random() - 0.5) * 10}px`;
      game.appendChild(dust);
      
      setTimeout(() => dust.remove(), 800);
    }
  }
  
  // üÜï –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª–æ—Å —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º
  let trafficLights = [];
  function createTrafficLight() {
    if (gameOverFlag) return;
    const lane = Math.floor(Math.random() * 5);
    
    const lightContainer = document.createElement('div');
    lightContainer.className = 'traffic-light';
    lightContainer.style.top = (lanePositions[lane] - 48) + 'px';
    lightContainer.style.left = window.innerWidth + 'px';
    
    // –°–≤–µ—Ç–æ—Ñ–æ—Ä —Å–≤–µ—Ä—Ö—É
    const lightEmoji = document.createElement('div');
    lightEmoji.textContent = 'üö¶';
    lightContainer.appendChild(lightEmoji);
    
    // –°—Ç–æ–ª–±–∏–∫ —Å–Ω–∏–∑—É
    const pole = document.createElement('div');
    pole.className = 'traffic-light-pole';
    lightContainer.appendChild(pole);
    
    game.appendChild(lightContainer);
    
    trafficLights.push({ 
      elem: lightContainer, 
      x: window.innerWidth, 
      lane, 
      speed: speedX * 0.5 
    });
  }
  
  // üÜï –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø—Ä–∏ —Å–±–æ—Ä–µ
  function createConfetti(x, y) {
    const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#95E1D3', '#F59E0B'];
    const gameRect = game.getBoundingClientRect();
    
    for (let i = 0; i < 12; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = `${x - gameRect.left}px`;
      confetti.style.top = `${y - gameRect.top}px`;
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.setProperty('--tx', `${(Math.random() - 0.5) * 200}px`);
      confetti.style.setProperty('--ty', `${Math.random() * 150 + 50}px`);
      game.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 1000);
    }
  }
  
  // üÜï –ü–æ–∫–∞–∑ –ø–ª–∞–≤–∞—é—â–∏—Ö –æ—á–∫–æ–≤
  function showFloatingScore(points, x, y) {
    const floatingScore = document.createElement('div');
    floatingScore.className = 'floating-score';
    floatingScore.textContent = `+${points}`;
    const gameRect = game.getBoundingClientRect();
    floatingScore.style.left = `${x - gameRect.left}px`;
    floatingScore.style.top = `${y - gameRect.top}px`;
    game.appendChild(floatingScore);
    
    setTimeout(() => floatingScore.remove(), 1500);
  }

  function updateScoreDisplay() {
    scoreElem.textContent = Math.floor(score);
  }
  function updateLivesDisplay() {
    lifeCountElem.textContent = lives.toFixed(1);
    const fullHearts = Math.floor(lives);
    const halfHeart = (lives % 1) >= 0.5 ? 1 : 0;
    let heartsStr = '';
    for(let i=0; i<fullHearts; i++) heartsStr += '‚ù§Ô∏è';
    if (halfHeart) heartsStr += 'üíî';
    livesElem.textContent = heartsStr || 'üíÄ';
  }

  function showSpeech(text) {
    if (speechTimeout) clearTimeout(speechTimeout);
    speechBubble.textContent = text;
    speechBubble.style.opacity = '1';
    const rect = courier.getBoundingClientRect();
    speechBubble.style.top = (rect.top - speechBubble.offsetHeight - 5) + 'px';
    speechBubble.style.left = (rect.left + courier.offsetWidth + 10) + 'px';

    speechTimeout = setTimeout(() => {
      speechBubble.style.opacity = '0';
    }, 3000);
  }
  function showSpeechRandom(arr) {
    const text = arr[Math.floor(Math.random() * arr.length)];
    showSpeech(text);
  }

  function activateSpeedBoost() {
    if (speedBoostActive) {
      clearTimeout(speedBoostTimeout);
    } else {
      speedBoostActive = true;
      speedX = Math.min(maxSpeedX, speedX + (isMobile ? 2 : 4));
      updateDashSpeed();
      showSpeech('‚ö°Ô∏è –£—Å–∫–æ—Ä–µ–Ω–∏–µ!');
    }
    speedBoostTimeout = setTimeout(() => {
      speedBoostActive = false;
      speedX = Math.max(isMobile ? 3 : 4, speedX - (isMobile ? 2 : 4));
      updateDashSpeed();
      showSpeech('‚ö°Ô∏è –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ');
    }, 7000);
  }
  function activateShield() {
    if (shieldActive) {
      clearTimeout(shieldTimeout);
    } else {
      shieldActive = true;
      showSpeech('üõ°Ô∏è –©–∏—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
      courier.style.filter = 'drop-shadow(0 0 10px #64b5f6)';
    }
    shieldTimeout = setTimeout(() => {
      shieldActive = false;
      showSpeech('üõ°Ô∏è –©–∏—Ç –∏—Å—á–µ–∑');
      courier.style.filter = '';
    }, 7000);
  }

  // –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
  let backgroundMusic = null;
  let musicStarted = false;
  let musicEnabled = true;
  let tryPlayOnInteraction = false;
  
  function initBackgroundMusic() {
    if (!backgroundMusic) {
      backgroundMusic = new Audio('/The_Black_Eyed_Peas_-_Pump_It_Ost_Taxi_64072506.mp3');
      backgroundMusic.loop = true;
      backgroundMusic.volume = isLowEndDevice ? 0.2 : 0.3; // –¢–∏—à–µ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
      backgroundMusic.preload = isLowEndDevice ? 'metadata' : 'auto'; // –ú–µ–Ω—å—à–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∑–∞–≥—Ä—É–∑–∫–∏
      backgroundMusic.addEventListener('loadeddata', () => {
        console.log('Music loaded successfully');
        if (tryPlayOnInteraction) {
          playBackgroundMusic();
        }
      });
    }
  }
  
  function playBackgroundMusic() {
    if (!musicEnabled) return;
    
    initBackgroundMusic();
    
    try {
      const playPromise = backgroundMusic.play();
      if (playPromise !== undefined) {
        playPromise.then(() => {
          musicStarted = true;
          tryPlayOnInteraction = false;
          console.log('Music playing');
          updateMusicButton();
        }).catch(err => {
          console.log('Autoplay blocked, waiting for interaction:', err);
          tryPlayOnInteraction = true;
          
          // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
          const startMusicOnInteraction = () => {
            if (!musicStarted && musicEnabled && backgroundMusic) {
              backgroundMusic.play().then(() => {
                musicStarted = true;
                tryPlayOnInteraction = false;
                updateMusicButton();
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
                document.removeEventListener('click', startMusicOnInteraction);
                document.removeEventListener('touchstart', startMusicOnInteraction);
                document.removeEventListener('touchend', startMusicOnInteraction);
                document.removeEventListener('keydown', startMusicOnInteraction);
              }).catch(() => {});
            }
          };
          
          document.addEventListener('click', startMusicOnInteraction);
          document.addEventListener('touchstart', startMusicOnInteraction);
          document.addEventListener('touchend', startMusicOnInteraction);
          document.addEventListener('keydown', startMusicOnInteraction);
        });
      }
    } catch (error) {
      console.warn('Background music playback failed:', error);
    }
  }
  
  function stopBackgroundMusic() {
    if (backgroundMusic) {
      backgroundMusic.pause();
      backgroundMusic.currentTime = 0;
      musicStarted = false;
    }
  }
  
  function toggleMusic() {
    musicEnabled = !musicEnabled;
    
    if (musicEnabled) {
      playBackgroundMusic();
    } else {
      if (backgroundMusic && !backgroundMusic.paused) {
        backgroundMusic.pause();
      }
    }
    
    updateMusicButton();
  }
  
  function updateMusicButton() {
    if (toggleMusicBtn) {
      if (musicEnabled) {
        toggleMusicBtn.textContent = 'üîä –ú—É–∑—ã–∫–∞: –í–ö–õ';
      } else {
        toggleMusicBtn.textContent = 'üîá –ú—É–∑—ã–∫–∞: –í–´–ö–õ';
      }
    }
  }
  
  function playSound(name) {
    // –ó–≤—É–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã, –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –º—É–∑—ã–∫–∞
  }

  function startSpawning() {
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –º–µ–Ω—å—à–µ –æ–±—ä–µ–∫—Ç–æ–≤
    const spawnMultiplier = isLowEndDevice ? 1.5 : 1;
    
    pedestrianSpawnTimer = setInterval(createPedestrian, 2200 * spawnMultiplier);
    standingPedSpawnTimer = setInterval(createStandingPedestrian, 2500 * spawnMultiplier);
    policeStandingSpawnTimer = setInterval(createPoliceStanding, 12000 * spawnMultiplier);
    foodSpawnTimer = setInterval(createFood, 1800 * spawnMultiplier);
    medkitSpawnTimer = setInterval(createMedkit, 9000 * spawnMultiplier);
    bonusSpawnTimer = setInterval(createBonus, 15000 * spawnMultiplier);
    policeCarSpawnTimer = setInterval(createPoliceCar, 25000 * spawnMultiplier);
    trafficLightSpawnTimer = setInterval(createTrafficLight, 4000 * spawnMultiplier); // üÜï –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã
  }
  function stopSpawning() {
    clearInterval(pedestrianSpawnTimer);
    clearInterval(standingPedSpawnTimer);
    clearInterval(policeStandingSpawnTimer);
    clearInterval(foodSpawnTimer);
    clearInterval(medkitSpawnTimer);
    clearInterval(bonusSpawnTimer);
    clearInterval(policeCarSpawnTimer);
    clearInterval(trafficLightSpawnTimer); // üÜï –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã
  }

  function checkUpcomingThreat() {
    if (gameOverFlag) return;

    const now = Date.now();
    if (now - lastSpeechTime < speechCooldown) return;

    const courierRect = courier.getBoundingClientRect();
    const thresholdMin = courierRect.right + 50;
    const thresholdMax = courierRect.right + 300;

    for (const p of pedestrians) {
      const pRect = p.elem.getBoundingClientRect();
      if (p.lane === courierLane && pRect.left >= thresholdMin && pRect.left <= thresholdMax) {
        showSpeechRandom(pedestrianPhrases);
        lastSpeechTime = now;
        return;
      }
    }
    for (const p of standingPeds) {
      const pRect = p.elem.getBoundingClientRect();
      if (p.lane === courierLane && pRect.left >= thresholdMin && pRect.left <= thresholdMax) {
        showSpeechRandom(pedestrianPhrases);
        lastSpeechTime = now;
        return;
      }
    }
    for (const p of policeStandings) {
      const pRect = p.elem.getBoundingClientRect();
      if (p.lane === courierLane && pRect.left >= thresholdMin && pRect.left <= thresholdMax) {
        showSpeechRandom(policePhrases);
        lastSpeechTime = now;
        return;
      }
    }
    for (const p of policeCars) {
      const pRect = p.elem.getBoundingClientRect();
      if (p.lane === courierLane && pRect.left >= thresholdMin && pRect.left <= thresholdMax) {
        showSpeechRandom(policePhrases);
        lastSpeechTime = now;
        return;
      }
    }
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª–æ—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
  function updateDashSpeed() {
    // speedX –æ—Ç 3/4 –¥–æ maxSpeedX -> duration –æ—Ç 1.5 –¥–æ 0.5 —Å–µ–∫
    const minDuration = 0.5;
    const maxDuration = 1.5;
    const baseSpeed = isMobile ? 3 : 4;
    const duration = maxDuration - ((speedX - baseSpeed) / (maxSpeedX - baseSpeed)) * (maxDuration - minDuration);
    lanes.forEach(lane => {
      lane.style.animationDuration = duration + 's';
    });
  }

  function gameTick(timestamp) {
    if (!lastFrameTime) lastFrameTime = timestamp;
    const delta = (timestamp - lastFrameTime) / 16.67; // –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤ (1 –∫–∞–¥—Ä = 16.67–º—Å)
    lastFrameTime = timestamp;

    if (!paused && !gameOverFlag) {
      // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —Ä–µ—á—å –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–µ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
      if (!isLowEndDevice || gameTime % 2 === 0) {
        checkUpcomingThreat();
      }

      if (moveCooldown > 0) {
        moveCooldown -= delta * 16.67;
      }
      if (moveCooldown <= 0) {
        if (movingUp && courierTargetLane > 0) {
          courierTargetLane--;
          moveCooldown = 200;
          createDustParticles(); // üÜï –ü—ã–ª—å –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
        } else if (movingDown && courierTargetLane < 4) {
          courierTargetLane++;
          moveCooldown = 200;
          createDustParticles(); // üÜï –ü—ã–ª—å –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
        }
      }

      updateCourierPositionSmooth();

      updateObjects(delta);

      checkCollisions();
      
      // üÜï –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—ã–ª—å –∏–∑-–ø–æ–¥ –∫–æ–ª–µ—Å
      if (!isLowEndDevice && gameTime % 3 === 0) {
        createDustParticles();
      }

      if (gameTime % 10 === 0 && speedX < maxSpeedX) {
        speedX += 0.015; // —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ —Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
        if (speedX > maxSpeedX) speedX = maxSpeedX;
        updateDashSpeed();
      }
      
      // üéÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Å—Ö–∞–ª–æ–∫
      easterEggCheckCounter++;
      if (easterEggCheckCounter % 600 === 0) { // –ö–∞–∂–¥—ã–µ ~10 —Å–µ–∫—É–Ω–¥
        spawnUFO();
      }
      if (easterEggCheckCounter % 60 === 0) { // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        checkDevilScore();
      }
    }

    requestAnimationFrame(gameTick);
  }

  function startTimer() {
    timerInterval = setInterval(() => {
      gameTime++;
      document.getElementById('timer').textContent = gameTime;
    }, 1000);
  }
  function stopTimer() {
    clearInterval(timerInterval);
  }

  function startGame() {
    pedestrians.forEach(p => p.elem.remove());
    standingPeds.forEach(p => p.elem.remove());
    policeStandings.forEach(p => p.elem.remove());
    foods.forEach(f => f.elem.remove());
    medkits.forEach(m => m.elem.remove());
    bonuses.forEach(b => b.elem.remove());
    policeCars.forEach(p => p.elem.remove());
    pedestrians = [];
    standingPeds = [];
    policeStandings = [];
    foods = [];
    medkits = [];
    bonuses = [];
    policeCars = [];
    
    // –ú—É–∑—ã–∫–∞ —É–∂–µ –∏–≥—Ä–∞–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º

    score = 0;
    lives = 3;
    gameTime = 0;
    comboCount = 0;
    speedX = isMobile ? 3 : 4;
    shieldActive = false;
    speedBoostActive = false;
    updateLivesDisplay();
    updateScoreDisplay();
    lifeCountElem.textContent = lives.toFixed(1);
    document.getElementById('timer').textContent = gameTime;
    gameOverFlag = false;
    paused = false;
    container.style.display = 'flex';
    info.style.display = 'block';
    livesElem.style.display = 'block';
    touchControls.style.display = isMobile ? 'flex' : 'none';
    recalcLanes();

    courierLane = 2;
    courierTargetLane = 2;
    courierCurrentY = lanePositions[courierLane] - courier.offsetHeight / 2;
    courier.style.top = courierCurrentY + 'px';

    updateDashSpeed();

    startSpawning(); // –°–≤–µ—Ç–æ—Ñ–æ—Ä—ã —Ç–µ–ø–µ—Ä—å —Å–ø–∞–≤–Ω—è—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª
    startTimer();

    lastFrameTime = 0;
    if (gameLoopId) cancelAnimationFrame(gameLoopId);
    gameLoopId = requestAnimationFrame(gameTick);
  }
  function stopGame() {
    cancelAnimationFrame(gameLoopId);
    stopSpawning();
    stopTimer();
    // –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º—É–∑—ã–∫—É –∑–¥–µ—Å—å - –æ–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å
    pedestrians.forEach(p => p.elem.remove());
    standingPeds.forEach(p => p.elem.remove());
    policeStandings.forEach(p => p.elem.remove());
    foods.forEach(f => f.elem.remove());
    medkits.forEach(m => m.elem.remove());
    bonuses.forEach(b => b.elem.remove());
    policeCars.forEach(p => p.elem.remove());
    trafficLights.forEach(tl => tl.remove()); // üÜï –£–¥–∞–ª—è–µ–º —Å–≤–µ—Ç–æ—Ñ–æ—Ä—ã
    pedestrians = [];
    standingPeds = [];
    policeStandings = [];
    foods = [];
    medkits = [];
    bonuses = [];
    policeCars = [];
    trafficLights = [];
    touchControls.style.display = 'none';
    movingUp = false;
    movingDown = false;
    moveCooldown = 0;
  }

  async function saveGameResult() {
    const finalScore = Math.floor(score);
    const userData = JSON.parse(localStorage.getItem('user_data') || 'null');
    
    if (!userData || !userData.id) {
      console.log('–ì–æ—Å—Ç—å –∏–≥—Ä–∞–µ—Ç - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è');
      return { isGuest: true };
    }

    const achievements = [];
    if (finalScore >= 100) achievements.push('first_delivery');
    if (finalScore >= 1000) achievements.push('speed_demon');
    if (finalScore >= 3000) achievements.push('high_roller');
    if (gameTime >= 60) achievements.push('survivor');
    if (comboCount >= 10) achievements.push('combo_master');

    try {
      const response = await fetch(
        'https://functions.poehali.dev/5f6f6889-3ab3-49f0-865b-fcffd245d858?route=game&action=save_score',
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-User-Id': userData.id.toString(),
          },
          body: JSON.stringify({
            score: finalScore,
            game_time: gameTime,
            achievements: achievements,
          }),
        }
      );

      const data = await response.json();
      if (data.success) {
        console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', data);
        return data;
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
    }
    return null;
  }

  function showGameOverAnimation() {
    container.style.display = 'none';
    info.style.display = 'none';
    livesElem.style.display = 'none';
    gameOverMenu.style.display = 'none';

    gtaGameOverScreen.style.display = 'flex';

    gtaGameOverScreen.style.animation = 'none';
    void gtaGameOverScreen.offsetWidth;
    gtaGameOverScreen.style.animation = 'gtaFadeInOut 5s forwards';

    setTimeout(async () => {
      gtaGameOverScreen.style.display = 'none';
      finalScoreElem.textContent = Math.floor(score);
      
      const saveResult = await saveGameResult();
      const gameOverMessage = document.getElementById('gameOverMessage');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      if (saveResult && saveResult.isGuest) {
        // –ì–æ—Å—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å"
        loginToSaveBtn.style.display = 'block';
        saveScoreBtn.style.display = 'none';
        gameOverMessage.textContent = 'üîê –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–æ–ø!';
        gameOverMessage.style.color = '#FFD700';
      } else if (saveResult) {
        // –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω
        loginToSaveBtn.style.display = 'none';
        saveScoreBtn.style.display = 'none';
        
        if (saveResult.is_new_record) {
          gameOverMessage.innerHTML = `üéâ –ù–û–í–´–ô –†–ï–ö–û–†–î!<br>–í–∞—à–µ –º–µ—Å—Ç–æ: #${saveResult.rank}`;
          gameOverMessage.style.color = '#FFD700';
        } else {
          gameOverMessage.innerHTML = `‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!<br>–í–∞—à–µ –º–µ—Å—Ç–æ: #${saveResult.rank}`;
          gameOverMessage.style.color = '#4ade80';
        }
        
        if (saveResult.new_achievements && saveResult.new_achievements.length > 0) {
          gameOverMessage.innerHTML += `<br>üèÜ –ù–æ–≤—ã—Ö –∞—á–∏–≤–æ–∫: ${saveResult.new_achievements.length}!`;
        }
      }
      
      gameOverMenu.style.display = 'block';
    }, 5000);
  }
  
  function gameOver() {
    if (gameOverFlag) return;
    gameOverFlag = true;
    stopGame();

    showGameOverAnimation();
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —Å—á—ë—Ç–æ–º
    if (window.parent && typeof window.parent.postMessage === 'function') {
      window.parent.postMessage({ type: 'GAME_OVER', score: score }, '*');
      console.log('üì§ Sent GAME_OVER to parent:', { score });
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–µ–Ω—é
  playBtn.addEventListener('click', () => {
    playBackgroundMusic();
    mainMenu.style.display = 'none';
    startGame();
  });
  
  leaderboardBtn.addEventListener('click', () => {
    if (window.parent && typeof window.parent.postMessage === 'function') {
      window.parent.postMessage({ type: 'openLeaderboard' }, '*');
    } else {
      window.location.href = '/leaderboard';
    }
  });
  
  // –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ —É–±—Ä–∞–Ω–∞ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é
  
  rulesBtn.addEventListener('click', () => {
    mainMenu.style.display = 'none';
    rulesDialog.style.display = 'block';
  });
  
  closeRulesBtn.addEventListener('click', () => {
    rulesDialog.style.display = 'none';
    mainMenu.style.display = 'block';
  });
  
  restartBtn.addEventListener('click', () => {
    gameOverMenu.style.cssText = '';
    gameOverMenu.style.display = 'none';
    startGame();
  });
  
  toMenuBtn.addEventListener('click', () => {
    gameOverMenu.style.display = 'none';
    
    // –°–±—Ä–æ—Å –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∏ —Å—Ç–∏–ª–µ–π
    mainMenu.style.cssText = '';
    mainMenu.style.display = 'block';
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π reflow –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    void mainMenu.offsetHeight;
    
    playBackgroundMusic();
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å"
  loginToSaveBtn.addEventListener('click', () => {
    if (window.parent && typeof window.parent.postMessage === 'function') {
      window.parent.postMessage({ type: 'closeGame' }, '*');
      setTimeout(() => {
        window.location.href = '/auth';
      }, 100);
    } else {
      window.location.href = '/auth';
    }
  });
  
  becomeBtn.addEventListener('click', () => {
    const referralLink = 'https://reg.eda.yandex.ru/?advertisement_campaign=forms_for_agents&user_invite_code=f123426cfad648a1afadad700e3a6b6b&utm_content=blank';
    const newWindow = window.open(referralLink, '_blank', 'noopener,noreferrer');
    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
      console.log('Popup blocked or failed to open');
    }
  });
  
  toggleMusicBtn.addEventListener('click', () => {
    toggleMusic();
  });

  // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  btnUp.addEventListener('touchstart', e => { e.preventDefault(); if (!gameOverFlag && !paused) movingUp = true; });
  btnUp.addEventListener('touchend', e => { e.preventDefault(); movingUp = false; });
  btnDown.addEventListener('touchstart', e => { e.preventDefault(); if (!gameOverFlag && !paused) movingDown = true; });
  btnDown.addEventListener('touchend', e => { e.preventDefault(); movingDown = false; });

  // üéÅ –ü–ê–°–•–ê–õ–ö–ò
  let konamiCode = [];
  const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
  let godModeActive = false;
  let rainbowModeActive = false;
  let lastEasterEggTime = 0;
  
  // üéÅ –ü–ê–°–•–ê–õ–ö–ê 1: Konami Code - –±–µ—Å—Å–º–µ—Ä—Ç–∏–µ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
  function checkKonamiCode(key) {
    konamiCode.push(key);
    if (konamiCode.length > 10) konamiCode.shift();
    
    if (JSON.stringify(konamiCode) === JSON.stringify(konamiSequence)) {
      activateGodMode();
      konamiCode = [];
    }
  }
  
  function activateGodMode() {
    if (godModeActive) return;
    godModeActive = true;
    shieldActive = true;
    showSpeech('üéÆ GOD MODE ACTIVATED! 30 —Å–µ–∫—É–Ω–¥ –±–µ—Å—Å–º–µ—Ä—Ç–∏—è!');
    courier.style.filter = 'drop-shadow(0 0 20px gold) brightness(1.5)';
    
    setTimeout(() => {
      godModeActive = false;
      shieldActive = false;
      courier.style.filter = '';
      showSpeech('üéÆ God Mode –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    }, 30000);
  }
  
  // üéÅ –ü–ê–°–•–ê–õ–ö–ê 2: –†–∞–¥—É–∂–Ω—ã–π —Ä–µ–∂–∏–º (–Ω–∞–∂–º–∏ R 3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–æ)
  let rPresses = 0;
  let rTimeout = null;
  function checkRainbowMode(key) {
    if (key === 'r') {
      rPresses++;
      if (rTimeout) clearTimeout(rTimeout);
      rTimeout = setTimeout(() => { rPresses = 0; }, 1000);
      
      if (rPresses === 3) {
        activateRainbowMode();
        rPresses = 0;
      }
    }
  }
  
  function activateRainbowMode() {
    if (rainbowModeActive) return;
    rainbowModeActive = true;
    showSpeech('üåà RAINBOW MODE! –†–∞–¥—É–∂–Ω—ã–µ –ø–æ–ª–æ—Å—ã!');
    
    const rainbowInterval = setInterval(() => {
      lanes.forEach((lane, i) => {
        const hue = (Date.now() / 10 + i * 60) % 360;
        lane.style.background = `linear-gradient(90deg, 
          hsl(${hue}, 70%, 30%) 0%, 
          hsl(${hue + 30}, 70%, 25%) 100%)`;
      });
    }, 50);
    
    setTimeout(() => {
      clearInterval(rainbowInterval);
      rainbowModeActive = false;
      lanes.forEach(lane => {
        lane.style.background = '';
      });
      showSpeech('üåà Rainbow Mode –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    }, 20000);
  }
  
  // üéÅ –ü–ê–°–•–ê–õ–ö–ê 3: –†–µ–¥–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –ù–õ–û (1% —à–∞–Ω—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
  function spawnUFO() {
    const now = Date.now();
    if (now - lastEasterEggTime < 30000) return; // –ù–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 30 —Å–µ–∫
    
    if (Math.random() < 0.01 && !gameOverFlag) {
      lastEasterEggTime = now;
      
      const ufo = document.createElement('div');
      ufo.textContent = 'üõ∏';
      ufo.style.position = 'absolute';
      ufo.style.fontSize = 'clamp(2rem, 5vw, 3rem)';
      ufo.style.top = '10%';
      ufo.style.left = window.innerWidth + 'px';
      ufo.style.zIndex = '100';
      ufo.style.animation = 'pulse 0.5s ease-in-out infinite';
      game.appendChild(ufo);
      
      showSpeech('üëΩ –ù–õ–û!!! +500 –æ—á–∫–æ–≤ –∑–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ!');
      score += 500;
      updateScoreDisplay();
      
      let ufoX = window.innerWidth;
      const ufoInterval = setInterval(() => {
        ufoX -= 15;
        ufo.style.left = ufoX + 'px';
        if (ufoX < -100) {
          clearInterval(ufoInterval);
          ufo.remove();
        }
      }, 50);
    }
  }
  
  // üéÅ –ü–ê–°–•–ê–õ–ö–ê 4: –°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ 666 –æ—á–∫–∞—Ö
  function checkDevilScore() {
    const currentScore = Math.floor(score);
    if (currentScore === 666) {
      showSpeech('üòà –°–∞—Ç–∞–Ω–∞ –æ–¥–æ–±—Ä—è–µ—Ç —Ç–≤–æ–π —Å–∫–∏–ª–ª! +100 –æ—á–∫–æ–≤!');
      score += 100;
      updateScoreDisplay();
      courier.style.filter = 'hue-rotate(180deg)';
      setTimeout(() => { courier.style.filter = ''; }, 3000);
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Å—Ö–∞–ª–∫–∏ –≤ –∏–≥—Ä–æ–≤–æ–º —Ü–∏–∫–ª–µ
  let easterEggCheckCounter = 0;

  // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –ø–∞—Å—Ö–∞–ª–∫–∞–º–∏
  window.addEventListener('keydown', e => {
    checkKonamiCode(e.key);
    checkRainbowMode(e.key);
    
    if (gameOverFlag || paused) return;
    if (e.key === 'ArrowUp' || e.key === 'w') movingUp = true;
    else if (e.key === 'ArrowDown' || e.key === 's') movingDown = true;
  });
  window.addEventListener('keyup', e => {
    if (e.key === 'ArrowUp' || e.key === 'w') movingUp = false;
    else if (e.key === 'ArrowDown' || e.key === 's') movingDown = false;
  });
  
  // üéÅ –ü–ê–°–•–ê–õ–ö–ê 5: –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª–∏–∫ –ø–æ –∫—É—Ä—å–µ—Ä—É (5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–æ)
  let courierClicks = 0;
  let courierClickTimeout = null;
  courier.addEventListener('click', () => {
    if (gameOverFlag) return;
    courierClicks++;
    
    if (courierClickTimeout) clearTimeout(courierClickTimeout);
    courierClickTimeout = setTimeout(() => { courierClicks = 0; }, 2000);
    
    if (courierClicks === 5) {
      showSpeech('üéâ –°–µ–∫—Ä–µ—Ç –Ω–∞–π–¥–µ–Ω! –¢—É—Ä–±–æ-—Å–∫–æ—Ä–æ—Å—Ç—å + —â–∏—Ç!');
      activateSpeedBoost();
      activateShield();
      score += 250;
      updateScoreDisplay();
      courierClicks = 0;
      
      // –°–ø–µ—Ü—ç—Ñ—Ñ–µ–∫—Ç
      for (let i = 0; i < 20; i++) {
        setTimeout(() => {
          const rect = courier.getBoundingClientRect();
          createConfetti(rect.left + rect.width / 2, rect.top + rect.height / 2);
        }, i * 100);
      }
    }
  });



  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω 5 —Å–µ–∫—É–Ω–¥, –ø–æ—Ç–æ–º –º–µ–Ω—é
  window.addEventListener('load', () => {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º—É–∑—ã–∫—É
    initBackgroundMusic();
    
    // –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ü–ö)
    setTimeout(() => playBackgroundMusic(), 100);
    
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞
    const tryStartMusic = () => {
      if (!musicStarted && musicEnabled) {
        playBackgroundMusic();
      }
    };
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –ª—é–±–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å —ç–∫—Ä–∞–Ω–æ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    welcomeScreen.addEventListener('click', tryStartMusic, { once: false });
    welcomeScreen.addEventListener('touchstart', tryStartMusic, { once: false });
    welcomeScreen.addEventListener('touchend', tryStartMusic, { once: false });
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –ª—é–±–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –º–µ–Ω—é
    const menuButtons = [playBtn, rulesBtn, toggleMusicBtn, becomeBtn];
    menuButtons.forEach(btn => {
      if (btn) {
        btn.addEventListener('touchstart', tryStartMusic, { once: false });
        btn.addEventListener('click', tryStartMusic, { once: false });
      }
    });
    
    setTimeout(() => {
      welcomeScreen.style.display = 'none';
      mainMenu.style.display = 'flex';
      // –ï—â—ë –æ–¥–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –º–µ–Ω—é
      setTimeout(() => playBackgroundMusic(), 100);
    }, 1500);
  });

  // –ü–µ—Ä–µ—Å—á—ë—Ç –ø–æ–ª–æ—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
  window.addEventListener('resize', () => {
    if (!gameOverFlag) recalcLanes();
  });
})();
</script>

</body>
</html>