# üéØ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞**: 2025-12-15  
**–ü—Ä–æ–µ–∫—Ç**: Courier Button Site

---

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1Ô∏è‚É£ **–ü—Ä–æ—Ñ–∏–ª—å –∫—É—Ä—å–µ—Ä–∞ - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£–ñ–ï –†–ê–ë–û–¢–ê–õ–û

**–ì–¥–µ**: `src/components/ProfileSetupModal.tsx`

**–ß—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è**:
- –§–ò–û (full_name)
- –¢–µ–ª–µ—Ñ–æ–Ω (phone) 
- –ì–æ—Ä–æ–¥ (city)

**API**: `POST /api?route=profile&action=update`

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `users` —Ç–∞–±–ª–∏—Ü–µ.

---

### 2Ô∏è‚É£ **–ê–¥–º–∏–Ω–∫–∞ - 44 –∫—É—Ä—å–µ—Ä–∞ (–ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞)**
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞**: Backend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–∞–±–ª–∏—Ü—É `couriers` (–∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ) –≤–º–µ—Å—Ç–æ `users` (—Ä–µ–∞–ª—å–Ω—ã–µ –∫—É—Ä—å–µ—Ä—ã)

**–†–µ—à–µ–Ω–∏–µ**:
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å –≤ `backend/admin-panel/index.py`
2. ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `users` —Ç–∞–±–ª–∏—Ü—É
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 4 —Ä–µ–∞–ª—å–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–∞ –≤–º–µ—Å—Ç–æ 44 –∏–≥—Ä–æ–≤—ã—Ö
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–¥—Å—á–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
5. ‚úÖ Backend –∑–∞–¥–µ–ø–ª–æ–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ê–¥–º–∏–Ω–∫–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –†–ï–ê–õ–¨–ù–´–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∞–π—Ç–∞!

---

### 3Ô∏è‚É£ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î - –Ω–∞–π–¥–µ–Ω–∞ –ø—Ä–∞–≤–¥–∞**
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ê–ó–û–ë–†–ê–ù–û

#### **–¢–∞–±–ª–∏—Ü–∞ `users`** - –†–ï–ê–õ–¨–ù–´–ï –∫—É—Ä—å–µ—Ä—ã —Å–∞–π—Ç–∞ (4 —á–µ–ª.)
```sql
id, oauth_provider, oauth_id, full_name, phone, city, 
email, referral_code, invited_by_user_id, total_orders,
external_id, created_at, vehicle_type, ...
```

**–ü—Ä–∏–º–µ—Ä—ã**:
- –ù–∏–∫–∏—Ç–∞ (ID 21) - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Yandex
- –î–µ–Ω–∏—Å –û–∫—É–Ω–µ–≤ (ID 28) - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Yandex  
- StueyGo Bot (ID 29) - –±–æ—Ç —á–µ—Ä–µ–∑ Telegram

#### **–¢–∞–±–ª–∏—Ü–∞ `couriers`** - –ò–ì–†–û–í–´–ï –¥–∞–Ω–Ω—ã–µ (44 –∞–∫–∫.)
```sql
id, username, total_deliveries, level, experience, 
current_vehicle, user_id (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL!)
```

–≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è 3D –∏–≥—Ä—ã "–ö—É—Ä—å–µ—Ä: –ì–æ—Ä–æ–¥ –≤ –¥–≤–∏–∂–µ–Ω–∏–∏"!

---

### 4Ô∏è‚É£ **CSV –∑–∞–≥—Ä—É–∑–∫–∞ - —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
**–°—Ç–∞—Ç—É—Å**: ‚è≥ –¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–ù–ï –°–î–ï–õ–ê–ù–û)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ–π—á–∞—Å**:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ï–¥–∞
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `courier_earnings`
- –°–≤—è–∑—å –ø–æ `external_id`

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –°–æ–∑–¥–∞–µ—Ç –ù–û–í–´–ï –∑–∞–ø–∏—Å–∏ –≤–º–µ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–≤—è–∑–∏ —Å `users`

**–ß—Ç–æ –ù–£–ñ–ù–û**:
1. –ò—Å–∫–∞—Ç—å –∫—É—Ä—å–µ—Ä–æ–≤ –≤ `users` –ø–æ `phone` –∏–ª–∏ `external_id`
2. –û–±–Ω–æ–≤–ª—è—Ç—å `courier_earnings_snapshot`
3. –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
4. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: –Ω–∞–π–¥–µ–Ω–æ / –æ–±–Ω–æ–≤–ª–µ–Ω–æ / –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

---

### 5Ô∏è‚É£ **Telegram –±–æ—Ç - —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
**–°—Ç–∞—Ç—É—Å**: ‚è≥ –¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–ù–ï –°–î–ï–õ–ê–ù–û)

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `couriers` –≤–º–µ—Å—Ç–æ `users` (—Å—Ç—Ä–æ–∫–∏ 116, 185)
2. ‚ùå –ß–∏—Ç–∞–µ—Ç –∏–∑ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π —Ç–∞–±–ª–∏—Ü—ã `referrals`
3. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
4. ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ß—Ç–æ –ù–£–ñ–ù–û –∏—Å–ø—Ä–∞–≤–∏—Ç—å**:
```python
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 115-117):
SELECT first_name, last_name, city, phone 
FROM t_p25272970_courier_button_site.couriers
WHERE id = %s

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
SELECT full_name, city, phone, referral_code
FROM t_p25272970_courier_button_site.users
WHERE id = %s
```

```python
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 144-146):
SELECT COUNT(*) as invited_count
FROM t_p25272970_courier_button_site.referrals
WHERE referrer_id = %s

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
SELECT COUNT(*) as invited_count
FROM t_p25272970_courier_button_site.users
WHERE invited_by_user_id = %s
```

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:

### ‚úÖ –†–ê–ë–û–¢–ê–ï–¢:
- –ü—Ä–æ—Ñ–∏–ª—å –∫—É—Ä—å–µ—Ä–∞ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –≥–æ—Ä–æ–¥–∞)
- –ê–¥–º–∏–Ω–∫–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 4 —Ä–µ–∞–ª—å–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–∞ –∏–∑ `users`)
- Backend –∞–¥–º–∏–Ω–∫–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω)
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∞–¥–º–∏–Ω–∫–µ
- –û–±–Ω—É–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
- CSV –∑–∞–≥—Ä—É–∑–∫–∞ (—Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç)
- Telegram –±–æ—Ç (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—å–µ—Ä–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ (backend –µ—Å—Ç—å, frontend –Ω–µ—Ç)

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 - –ö–†–ò–¢–ò–ß–ù–û:
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Telegram –±–æ—Ç–∞**
   - –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `couriers` –Ω–∞ `users`
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `referral_code` –∏–∑ `users`

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å CSV –∑–∞–≥—Ä—É–∑–∫—É**
   - –ò—Å–∫–∞—Ç—å –ø–æ `phone` –≤ `users`
   - UPDATE –≤–º–µ—Å—Ç–æ INSERT
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 - –í–ê–ñ–ù–û:
3. **–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∞–¥–º–∏–Ω–∫–µ**
   - Modal –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞
   - –ö–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" / "–£–¥–∞–ª–∏—Ç—å"
   - API —É–∂–µ –µ—Å—Ç—å –≤ `backend/api/index.py`

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `invited_by_user_id` —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–ª–∞—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 - –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û:
5. **–û—á–∏—Å—Ç–∏—Ç—å –∏–≥—Ä–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `couriers`**
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - –û–±–Ω–æ–≤–∏—Ç—å SYSTEM_ARCHITECTURE.md
   - –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–≤—è–∑–µ–π
   - –û–ø–∏—Å–∞—Ç—å –≤—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

---

## üöÄ –ì–û–¢–û–í–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### ‚úÖ backend/admin-panel/index.py
**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ**:
1. –ó–∞–ø—Ä–æ—Å `get_all_couriers` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `users` –≤–º–µ—Å—Ç–æ `couriers`
2. –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–æ–ª—è: email, referral_code, external_id, avatar_url
3. –ü–æ–¥—Å—á–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —á–µ—Ä–µ–∑ `invited_by_user_id`
4. –£–¥–∞–ª–µ–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç `users` –≤–º–µ—Å—Ç–æ `couriers`
5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∏—Ç–∞–µ—Ç –∏–∑ `users`

**–î–µ–ø–ª–æ–π**: ‚úÖ –£—Å–ø–µ—à–Ω–æ (URL: https://functions.poehali.dev/11e2050a-12a1-4797-9ba5-1f3b27437559)

**–¢–µ—Å—Ç—ã**: ‚úÖ 3/3 –ø—Ä–æ—à–ª–∏

---

## üìù SQL –ó–ê–ü–†–û–°–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–æ–≤:
```sql
SELECT id, full_name, phone, city, oauth_provider, created_at 
FROM t_p25272970_courier_button_site.users 
ORDER BY created_at DESC;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
```sql
SELECT id, username, level, total_deliveries, user_id
FROM t_p25272970_courier_button_site.couriers
WHERE user_id IS NULL
ORDER BY created_at DESC;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:
```sql
SELECT 
  u1.full_name as referrer,
  u2.full_name as referred,
  u2.created_at
FROM t_p25272970_courier_button_site.users u1
JOIN t_p25272970_courier_button_site.users u2 ON u2.invited_by_user_id = u1.id
ORDER BY u2.created_at DESC;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É Telegram:
```sql
SELECT 
  mc.messenger_user_id as telegram_id,
  mc.messenger_username,
  u.full_name,
  u.phone
FROM t_p25272970_courier_button_site.messenger_connections mc
JOIN t_p25272970_courier_button_site.users u ON u.id = mc.courier_id
WHERE mc.messenger_type = 'telegram' AND mc.is_verified = true;
```

---

## ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:

1. **–ù–ï —É–¥–∞–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—É `couriers`** - —ç—Ç–æ –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ!
2. **–ù–ï —Å–º–µ—à–∏–≤–∞—Ç—å** `users` –∏ `couriers` - —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
3. **CSV –∑–∞–≥—Ä—É–∑–∫–∞** –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –¢–û–õ–¨–ö–û —Å `users`
4. **Telegram –±–æ—Ç** –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å –¢–û–õ–¨–ö–û –∏–∑ `users`

---

**–ö–û–ù–ï–¶ –û–¢–ß–ï–¢–ê**
